<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Syllogiser - Statement &amp; Syllogism Visualiser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            background: #f0f4f8;
        }

        .container {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        .left-panel {
            min-width: 320px;
            width: 48%;
            background: #ffffff;
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #e2e8f0;
        }

        .resizer {
            width: 6px;
            background: #cbd5e1;
            cursor: col-resize;
            transition: background 0.2s;
            touch-action: none;
        }

        .resizer:hover,
        .resizer.active {
            background: #94a3b8;
        }

        .right-panel {
            flex: 1;
            min-width: 400px;
            background: #f8fafc;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 1.3rem;
            color: #1e293b;
            text-align: center;
        }

        .help-btn {
            padding: 6px 14px;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .help-btn:hover {
            background: linear-gradient(135deg, #4f46e5, #4338ca);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        h2 {
            font-size: 1.1rem;
            color: #475569;
            margin-bottom: 15px;
        }

        /* Help Modal Styles */
        .help-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .help-modal-overlay.visible {
            display: flex;
        }

        .help-modal {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            max-height: 90vh;
            width: 100%;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            display: flex;
            flex-direction: column;
        }

        .help-modal-header {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-modal-header h2 {
            color: white;
            margin: 0;
            font-size: 1.4rem;
        }

        .help-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .help-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .help-modal-content {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .help-section {
            margin-bottom: 25px;
        }

        .help-section:last-child {
            margin-bottom: 0;
        }

        .help-section h3 {
            color: #1e40af;
            font-size: 1.15rem;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section h4 {
            color: #475569;
            font-size: 1rem;
            margin: 15px 0 8px 0;
        }

        .help-section p {
            color: #475569;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .help-section ul {
            margin-left: 20px;
            color: #475569;
            line-height: 1.8;
        }

        .help-section li {
            margin-bottom: 6px;
        }

        .help-section li strong {
            color: #1e40af;
        }

        .help-tip {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .help-tip p {
            margin: 0;
            color: #1e40af;
        }

        .help-warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .help-warning p {
            margin: 0;
            color: #92400e;
        }

        .help-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .help-table th,
        .help-table td {
            border: 1px solid #e2e8f0;
            padding: 10px 12px;
            text-align: left;
        }

        .help-table th {
            background: #f1f5f9;
            color: #1e40af;
            font-weight: 600;
        }

        .help-table td {
            color: #475569;
        }

        .help-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .help-table-shortcut {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .help-table-shortcut th,
        .help-table-shortcut td {
            border: 1px solid #e2e8f0;
            padding: 10px 12px;
            text-align: left;
        }

        .help-table-shortcut th {
            background: #fef3c7;
            color: #92400e;
            font-weight: 600;
        }

        .help-table-shortcut td {
            color: #475569;
        }

        .help-table-shortcut tr:nth-child(even) {
            background: #fffbeb;
        }

        .help-table-shortcut tr:nth-child(odd) {
            background: #fefce8;
        }

        .help-credits {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .help-credits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .help-credit-item {
            text-align: center;
        }

        .help-credit-item .label {
            font-size: 0.8rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .help-credit-item .value {
            font-size: 1rem;
            color: #1e293b;
            font-weight: 600;
        }

        .help-license {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .help-license h4 {
            color: #1e40af;
            margin-top: 0;
        }

        .help-citation {
            background: #e0e7ff;
            padding: 12px 15px;
            border-radius: 6px;
            font-family: 'Georgia', serif;
            font-style: italic;
            color: #3730a3;
        }

        .help-contact {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .help-contact h4 {
            color: #1e40af;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .help-contact p {
            margin: 8px 0;
        }

        .help-contact a {
            color: #2563eb;
            text-decoration: none;
        }

        .help-contact a:hover {
            text-decoration: underline;
        }

        .help-subsection {
            background: #fffbeb;
            border: 1px solid #fcd34d;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .help-subsection h4 {
            color: #92400e;
            font-size: 1.05rem;
            margin-top: 0;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-subsection p {
            color: #78350f;
            margin-bottom: 10px;
        }

        .help-derivation-box {
            background: white;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 10px 0;
            border-left: 3px solid #f59e0b;
        }

        .help-derivation-box strong {
            color: #b45309;
        }

        /* Settings Section Styles */
        .help-settings-box {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .help-settings-box h4 {
            color: #166534;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .layout-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .layout-option {
            flex: 1;
            min-width: 200px;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .layout-option:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
        }

        .layout-option.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .layout-option .layout-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .layout-option .layout-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .layout-option .layout-desc {
            font-size: 0.85rem;
            color: #64748b;
        }

        .layout-diagram {
            width: 80px;
            height: 60px;
            margin: 0 auto 10px;
            position: relative;
        }

        .layout-diagram .circle {
            width: 30px;
            height: 30px;
            border: 2px solid;
            border-radius: 50%;
            position: absolute;
        }

        .layout-diagram .circle.s {
            border-color: #3b82f6;
            left: 5px;
        }

        .layout-diagram .circle.p {
            border-color: #ef4444;
            right: 5px;
        }

        .layout-diagram .circle.m {
            border-color: #22c55e;
            left: 50%;
            transform: translateX(-50%);
        }

        .layout-diagram.upright .circle.s { bottom: 0; }
        .layout-diagram.upright .circle.p { bottom: 0; }
        .layout-diagram.upright .circle.m { top: 0; }

        .layout-diagram.inverted .circle.s { top: 0; }
        .layout-diagram.inverted .circle.p { top: 0; }
        .layout-diagram.inverted .circle.m { bottom: 0; }

        /* Singular Proposition Note */
        .singular-note {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 12px 15px;
            margin-top: 15px;
        }

        .singular-note h4 {
            color: #92400e;
            margin: 0 0 8px 0;
            font-size: 0.95rem;
        }

        .singular-note p {
            color: #78350f;
            margin: 0;
            font-size: 0.9rem;
        }

        /* Sorites Section Styles */
        .help-sorites-box {
            background: #fdf4ff;
            border: 1px solid #e879f9;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .help-sorites-box h4 {
            color: #86198f;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .help-sorites-box p {
            color: #701a75;
        }

        .help-sorites-example {
            background: white;
            border-radius: 8px;
            padding: 12px 15px;
            margin: 10px 0;
            border-left: 3px solid #c026d3;
        }

        .help-sorites-example .premise {
            margin: 4px 0;
            color: #475569;
        }

        .help-sorites-example .conclusion {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e879f9;
            color: #86198f;
            font-weight: 600;
        }

        /* Euler Diagram Section Styles */
        .help-euler-box {
            background: #ecfeff;
            border: 1px solid #22d3d1;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }

        .help-euler-box h4 {
            color: #0e7490;
            margin-top: 0;
            margin-bottom: 12px;
        }

        .help-euler-box p {
            color: #155e75;
        }

        .help-euler-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .help-euler-item {
            background: white;
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #cffafe;
        }

        .help-euler-item h5 {
            color: #0891b2;
            margin: 0 0 8px 0;
            font-size: 0.95rem;
        }

        .help-euler-item p {
            margin: 0;
            font-size: 0.85rem;
        }

        /* Mode Toggle Styles */
        .mode-toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 10px;
        }

        .mode-label {
            font-size: 0.95rem;
            font-weight: 600;
            color: #64748b;
            transition: color 0.3s;
        }

        .mode-label.active {
            color: #1e40af;
        }

        .mode-toggle {
            position: relative;
            width: 80px;
            height: 36px;
            background: #3b82f6;
            border-radius: 18px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .mode-toggle.statement-mode {
            background: #8b5cf6;
        }

        .mode-toggle-slider {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .mode-toggle.statement-mode .mode-toggle-slider {
            transform: translateX(-44px);
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .button-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .reset-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .reset-btn:hover {
            background: #dc2626;
        }

        .copy-btn {
            padding: 8px 12px;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .copy-btn:hover {
            background: #7c3aed;
        }

        .copy-btn.green {
            background: #10b981;
        }

        .copy-btn.green:hover {
            background: #059669;
        }

        .proposition-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .proposition-table th,
        .proposition-table td {
            border: 1px solid #e2e8f0;
            padding: 10px 8px;
            text-align: center;
        }

        .proposition-table th {
            background: #3b82f6;
            color: white;
            font-weight: 600;
        }

        .proposition-table.statement-mode th {
            background: #8b5cf6;
        }

        .proposition-table td:first-child {
            background: #eff6ff;
            font-weight: 600;
            color: #1e40af;
            min-width: 120px;
        }

        .proposition-table.statement-mode td:first-child {
            background: #f5f3ff;
            color: #6d28d9;
        }

        .proposition-table select,
        .proposition-table input {
            width: 100%;
            padding: 6px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        .proposition-table select:focus,
        .proposition-table input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .proposition-table input.error {
            border-color: #ef4444;
            background-color: #fef2f2;
        }

        .term-cell {
            position: relative;
        }

        .term-cell input,
        .term-cell select {
            padding-right: 35px;
        }

        .distribution-badge {
            position: absolute;
            right: 4px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 3px;
            pointer-events: none;
        }

        .distribution-badge.distributed {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        .distribution-badge.undistributed {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        /* Copula cell with alternative expression */
        .copula-cell {
            position: relative;
        }

        .copula-cell select {
            width: 100%;
        }

        .alternative-expression {
            display: block;
            font-size: 0.7rem;
            color: #059669;
            font-weight: 600;
            margin-top: 4px;
            padding: 2px 4px;
            background: #ecfdf5;
            border-radius: 3px;
        }

        .quantifier-cell {
            position: relative;
        }

        .alternative-quantifier {
            display: block;
            font-size: 0.7rem;
            color: #059669;
            font-weight: 600;
            margin-top: 4px;
            padding: 2px 4px;
            background: #ecfdf5;
            border-radius: 3px;
        }

        .type-display {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .type-item {
            text-align: center;
        }

        .type-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .type-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
        }

        .type-display.statement-mode .type-value {
            color: #8b5cf6;
        }

        .knowledge-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .knowledge-table th,
        .knowledge-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }

        .knowledge-table th {
            background: #1e40af;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .knowledge-table td:first-child {
            background: #fefce8;
            width: 45%;
        }

        .knowledge-table td:last-child {
            background: #f0fdf4;
            width: 55%;
        }

        .knowledge-section-title {
            font-weight: bold;
            color: #854d0e;
            margin-bottom: 8px;
        }

        .knowledge-item {
            margin: 6px 0;
            color: #374151;
            line-height: 1.5;
        }

        .knowledge-item strong {
            color: #1e40af;
        }

        .figure-title {
            font-weight: bold;
            color: #166534;
            margin-top: 10px;
            margin-bottom: 4px;
        }

        .figure-title:first-child {
            margin-top: 0;
        }

        .figure-pattern {
            font-family: monospace;
            background: #dcfce7;
            padding: 2px 6px;
            border-radius: 4px;
            color: #166534;
        }

        .warning-box {
            margin-top: 15px;
            padding: 12px 15px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            color: #dc2626;
            font-size: 0.85rem;
            display: none;
        }

        .warning-box.visible {
            display: block;
        }

        .warning-box h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warning-box ul {
            margin-left: 20px;
        }

        .warning-box li {
            margin: 4px 0;
        }

        .validation-success {
            margin-top: 15px;
            padding: 12px 15px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            color: #16a34a;
            font-size: 0.85rem;
            display: none;
        }

        .validation-success.visible {
            display: block;
        }

        .check-validity-btn {
            display: block;
            width: 100%;
            margin-top: 15px;
            padding: 14px 24px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .check-validity-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .check-validity-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .check-validity-btn:disabled {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            cursor: not-allowed;
            box-shadow: none;
        }

        .validity-display {
            margin-top: 15px;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .validity-display.pending {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 3px solid #94a3b8;
        }

        .validity-display.valid {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border: 3px solid #10b981;
        }

        .validity-display.conditional {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border: 3px solid #f59e0b;
        }

        .validity-display.invalid {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            border: 3px solid #ef4444;
        }

        .validity-form-code {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }

        .validity-display.pending .validity-form-code {
            color: #64748b;
        }

        .validity-display.valid .validity-form-code {
            color: #059669;
        }

        .validity-display.conditional .validity-form-code {
            color: #d97706;
        }

        .validity-display.invalid .validity-form-code {
            color: #dc2626;
        }

        .validity-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .validity-display.pending .validity-name {
            color: #475569;
        }

        .validity-display.valid .validity-name {
            color: #047857;
        }

        .validity-display.conditional .validity-name {
            color: #b45309;
        }

        .validity-display.invalid .validity-name {
            color: #b91c1c;
        }

        .validity-badge {
            display: inline-block;
            padding: 8px 24px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .validity-display.pending .validity-badge {
            background: #94a3b8;
            color: white;
        }

        .validity-display.valid .validity-badge {
            background: #10b981;
            color: white;
        }

        .validity-display.conditional .validity-badge {
            background: #f59e0b;
            color: white;
        }

        .validity-display.invalid .validity-badge {
            background: #ef4444;
            color: white;
        }

        .validity-note {
            margin-top: 12px;
            font-size: 0.85rem;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .validity-display.pending .validity-note {
            color: #475569;
        }

        .validity-display.valid .validity-note {
            color: #065f46;
        }

        .validity-display.conditional .validity-note {
            color: #92400e;
        }

        .validity-display.invalid .validity-note {
            color: #991b1b;
        }

        .term-label {
            transition: all 0.3s ease;
        }

        .term-label.major {
            color: #16a34a;
        }

        .term-label.minor {
            color: #ea580c;
        }

        .divider {
            width: 1px;
            height: 24px;
            background: #cbd5e1;
        }

        /* Tab Styles */
        .tab-container {
            display: flex;
            background: #e2e8f0;
            border-bottom: 2px solid #cbd5e1;
            flex-shrink: 0;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: #e2e8f0;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s;
            position: relative;
        }

        .tab-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }

        .tab-btn.active {
            background: #f8fafc;
            color: #1e40af;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3b82f6;
        }

        .tab-btn .tab-icon {
            margin-right: 8px;
        }

        .tab-btn.premises {
            border-right: 1px solid #cbd5e1;
        }

        .tab-btn.premises.active {
            color: #7c3aed;
        }

        .tab-btn.premises.active::after {
            background: #7c3aed;
        }

        .tab-btn.conclusion.active {
            color: #059669;
        }

        .tab-btn.conclusion.active::after {
            background: #059669;
        }

        .tab-content {
            flex: 1;
            position: relative;
            display: none;
            overflow: hidden;
            flex-direction: column;
        }

        .tab-content.active {
            display: flex;
        }

        .canvas-container {
            width: 100%;
            flex: 1;
            position: relative;
            min-height: 0;
        }

        .venn-canvas {
            width: 100%;
            height: 100%;
            cursor: default;
            touch-action: none;
        }

        /* Toolbar - Combined at top */
        .toolbar {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(255, 255, 255, 0.98);
            padding: 12px 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            flex-shrink: 0;
        }

        .toolbar-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .toolbar-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-btn {
            padding: 6px 12px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: background 0.2s;
        }

        .toolbar-btn:hover {
            background: #2563eb;
        }

        .toolbar-btn.danger {
            background: #ef4444;
        }

        .toolbar-btn.danger:hover {
            background: #dc2626;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        .toggle-switch {
            position: relative;
            width: 100px;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.aristotelian {
            background: #c7d2fe;
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 46px;
            height: 24px;
            background: white;
            border-radius: 12px;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: bold;
            color: #475569;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch.aristotelian .toggle-slider {
            transform: translateX(48px);
            color: #4f46e5;
        }

        /* Color palette - now in toolbar */
        .color-palette {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .color-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s;
        }

        .color-btn:hover {
            transform: scale(1.15);
        }

        .color-btn.selected {
            border-color: #1e293b;
        }

        .clear-btn {
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.75rem;
            transition: background 0.2s;
        }

        .clear-btn:hover {
            background: #dc2626;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Proposition Types Info Table for Statement Mode */
        .proposition-types-info {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.85rem;
        }

        .proposition-types-info th,
        .proposition-types-info td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }

        .proposition-types-info th {
            background: #8b5cf6;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .proposition-types-info td {
            background: #fefce8;
        }

        .proposition-types-info .knowledge-item {
            margin: 6px 0;
            color: #374151;
            line-height: 1.5;
        }

        .proposition-types-info .knowledge-item strong {
            color: #6d28d9;
        }

        /* Proving Section */
        .proving-section {
            margin-top: 20px;
        }

        .proving-section h3 {
            font-size: 1rem;
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .proving-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }

        .proving-table th,
        .proving-table td {
            border: 1px solid #e2e8f0;
            padding: 10px 8px;
            text-align: left;
            vertical-align: top;
        }

        .proving-table th {
            background: #1e40af;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .proving-table th:nth-child(1) {
            width: 18%;
        }

        .proving-table th:nth-child(2) {
            width: 40%;
        }

        .proving-table th:nth-child(3) {
            width: 12%;
        }

        .proving-table th:nth-child(4) {
            width: 30%;
        }

        .proving-table td:first-child {
            background: #eff6ff;
            font-weight: 600;
            color: #1e40af;
        }

        .proving-table td:nth-child(2) {
            background: #f8fafc;
            color: #475569;
            line-height: 1.4;
        }

        .proving-table td:nth-child(3) {
            background: #fefce8;
            text-align: center;
        }

        .proving-table td:nth-child(4) {
            background: #fef2f2;
        }

        .proving-table select {
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            width: 100%;
        }

        .proving-table select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .fallacy-text {
            color: #9ca3af;
            font-style: italic;
        }

        .fallacy-text.active-no {
            color: #dc2626;
            font-weight: 600;
            font-style: normal;
        }

        .fallacy-text.active-yes {
            color: transparent;
        }

        /* System Proving Button */
        .system-proving-btn {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
            margin-bottom: 20px;
        }

        .system-proving-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #7c3aed, #5b21b6);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .system-proving-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .system-proving-btn:disabled {
            background: linear-gradient(135deg, #94a3b8, #64748b);
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Web Search Section */
        .search-section {
            margin-top: 20px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 10px;
        }

        .search-section h3 {
            font-size: 1rem;
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 10px 14px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #1e293b;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .search-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: #10b981;
        }

        .toast.info {
            background: #3b82f6;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .left-panel {
                width: 100%;
                min-width: unset;
                max-height: 50vh;
                border-right: none;
                border-bottom: 2px solid #e2e8f0;
            }

            .resizer {
                width: 100%;
                height: 6px;
                cursor: row-resize;
            }

            .right-panel {
                min-width: unset;
                flex: 1;
            }

            h1 {
                font-size: 1.1rem;
            }

            .toolbar {
                padding: 10px 12px;
                gap: 8px;
            }

            .toolbar-row {
                gap: 6px;
            }

            .toolbar-btn {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            .color-btn {
                width: 24px;
                height: 24px;
            }

            .clear-btn {
                padding: 5px 10px;
                font-size: 0.7rem;
            }

            .tab-btn {
                padding: 12px 10px;
                font-size: 0.9rem;
            }

            .canvas-container {
                min-height: 300px;
            }

            .toggle-switch {
                width: 80px;
                height: 26px;
            }

            .toggle-slider {
                width: 38px;
                height: 20px;
                font-size: 0.6rem;
            }

            .toggle-switch.aristotelian .toggle-slider {
                transform: translateX(38px);
            }

            .header-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .button-group {
                width: 100%;
                justify-content: flex-start;
            }

            .copy-btn {
                font-size: 0.75rem;
                padding: 6px 10px;
            }

            .help-euler-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Help Modal -->
    <div class="help-modal-overlay" id="helpModal">
        <div class="help-modal">
            <div class="help-modal-header">
                <h2>üìö Syllogiser - Help &amp; User Guide</h2>
                <button class="help-modal-close" onclick="closeHelpModal()">√ó</button>
            </div>
            <div class="help-modal-content">
                <!-- Introduction -->
                <div class="help-section">
                    <h3>üëã Welcome</h3>
                    <p>Welcome to <strong>Syllogiser</strong>! This educational platform helps you learn and understand categorical logic through interactive diagrams. Whether you're studying basic propositions or complex syllogistic arguments, this tool provides visual representations to enhance your understanding.</p>
                    <p><strong>Syllogiser</strong> is unique in that it supports both <strong>Venn Diagrams</strong> and <strong>Euler Diagrams</strong>, making it a versatile tool for all your logical diagramming needs.</p>
                </div>

                <!-- Settings Section -->
                <div class="help-section">
                    <h3>‚öôÔ∏è Settings</h3>
                    <p>Customize the diagram display to suit your preference:</p>
                    
                    <div class="help-settings-box">
                        <h4>üìê Venn Diagram Layout</h4>
                        <p>Choose how the three circles are arranged in Syllogism Mode:</p>
                        <div class="layout-options">
                            <div class="layout-option selected" id="layoutUpright" onclick="setLayout('upright')">
                                <div class="layout-diagram upright">
                                    <div class="circle s"></div>
                                    <div class="circle p"></div>
                                    <div class="circle m"></div>
                                </div>
                                <div class="layout-name">Upright</div>
                                <div class="layout-desc">Middle term (M) on top<br>S on left, P on right</div>
                            </div>
                            <div class="layout-option" id="layoutInverted" onclick="setLayout('inverted')">
                                <div class="layout-diagram inverted">
                                    <div class="circle s"></div>
                                    <div class="circle p"></div>
                                    <div class="circle m"></div>
                                </div>
                                <div class="layout-name">Inverted</div>
                                <div class="layout-desc">Middle term (M) on bottom<br>S on left, P on right</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Euler Diagrams Section -->
                <div class="help-section">
                    <h3>‚≠ï Euler Diagram Support</h3>
                    <p><strong>Syllogiser</strong> is (probably) the only application that supports both <strong>Venn Diagrams</strong> and <strong>Euler Diagrams</strong> for syllogism visualization. This dual support gives you flexibility in how you represent logical relationships.</p>
                    
                    <div class="help-euler-box">
                        <h4>üîÑ How to Create Euler Diagrams</h4>
                        <p>Unlike Venn diagrams where all circles overlap in a fixed pattern, Euler diagrams allow you to <strong>resize and reposition circles</strong> to show actual set relationships:</p>
                        <ul>
                            <li><strong>Resize circles:</strong> Drag the edge of any circle to make it larger or smaller</li>
                            <li><strong>Move circles:</strong> Drag from the center of a circle to reposition it</li>
                            <li><strong>Show containment:</strong> Make one circle smaller and place it entirely inside another</li>
                            <li><strong>Show exclusion:</strong> Move circles apart so they don't overlap</li>
                            <li><strong>Show partial overlap:</strong> Position circles to overlap partially</li>
                        </ul>
                        
                        <div class="help-euler-comparison">
                            <div class="help-euler-item">
                                <h5>Venn Diagram</h5>
                                <p>All possible intersections are shown. Empty regions are shaded to indicate they have no members. Fixed circle sizes and positions.</p>
                            </div>
                            <div class="help-euler-item">
                                <h5>Euler Diagram</h5>
                                <p>Only actual relationships are shown. Circle size and position indicate set relationships directly. More intuitive for some users.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="help-tip">
                        <p>üí° <strong>Tip:</strong> Use <strong>Diagram 1</strong> for Euler diagrams and <strong>Diagram 2</strong> for Venn diagrams to compare both representations side by side!</p>
                    </div>
                </div>

                <!-- Resizable Panels -->
                <div class="help-section">
                    <h3>üìè Resizable Panels</h3>
                    <p>You can adjust the size of the left and right panels to give yourself more space for diagramming:</p>
                    <ul>
                        <li><strong>Drag the divider</strong> between the left panel (propositions) and right panel (diagrams) to resize</li>
                        <li><strong>Make the diagram larger</strong> by dragging the divider to the left</li>
                        <li><strong>Make the propositions panel larger</strong> by dragging the divider to the right</li>
                        <li><strong>Works with both mouse and touch</strong> - drag with your finger on mobile devices</li>
                    </ul>
                    <div class="help-tip">
                        <p>üí° <strong>Tip:</strong> For detailed diagram work, drag the divider far to the left to maximize your canvas space while still keeping the propositions visible.</p>
                    </div>
                </div>

                <!-- Modes -->
                <div class="help-section">
                    <h3>üîÑ Two Operating Modes</h3>
                    <p>The platform offers two modes accessible via the toggle switch at the top:</p>
                    <ul>
                        <li><strong>Statement Mode:</strong> For analyzing single categorical propositions (A, E, I, O types) with two-circle diagrams</li>
                        <li><strong>Syllogism Mode:</strong> For analyzing categorical syllogisms with three-circle diagrams, including validity checking and formal proving</li>
                    </ul>
                    <div class="help-tip">
                        <p>üí° <strong>Tip:</strong> Start with Statement Mode to understand basic propositions before moving to Syllogism Mode.</p>
                    </div>
                </div>

                <!-- Proposition Types -->
                <div class="help-section">
                    <h3>üìù Categorical Proposition Types</h3>
                    <p>There are four standard forms of categorical propositions:</p>
                    <table class="help-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Name</th>
                                <th>Form</th>
                                <th>Subject</th>
                                <th>Predicate</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>A</strong></td>
                                <td>Universal Affirmative</td>
                                <td>All S are P</td>
                                <td>Distributed</td>
                                <td>Undistributed</td>
                            </tr>
                            <tr>
                                <td><strong>E</strong></td>
                                <td>Universal Negative</td>
                                <td>No S are P</td>
                                <td>Distributed</td>
                                <td>Distributed</td>
                            </tr>
                            <tr>
                                <td><strong>I</strong></td>
                                <td>Particular Affirmative</td>
                                <td>Some S are P</td>
                                <td>Undistributed</td>
                                <td>Undistributed</td>
                            </tr>
                            <tr>
                                <td><strong>O</strong></td>
                                <td>Particular Negative</td>
                                <td>Some S are not P</td>
                                <td>Undistributed</td>
                                <td>Distributed</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>Distribution:</strong> A term is distributed when the proposition makes a claim about ALL members of that category. Badges show <span style="background:#dcfce7;padding:2px 6px;border-radius:3px;color:#166534;font-weight:bold;">D</span> for distributed and <span style="background:#fef3c7;padding:2px 6px;border-radius:3px;color:#92400e;font-weight:bold;">xD</span> for undistributed.</p>
                    
                    <div class="singular-note">
                        <h4>üìå Note on Singular Propositions</h4>
                        <p>In traditional categorical syllogisms, a <strong>singular proposition</strong> (e.g., "Socrates is a man" or "This cat is black") is generally treated as a <strong>universal proposition</strong>. This is because a singular term refers to exactly one individual, and the proposition makes a claim about the entire extension of that term (which contains only one member). Thus, "Socrates is mortal" is logically equivalent to "All Socrates are mortal" for syllogistic purposes.</p>
                    </div>
                </div>

                <!-- Syllogism Figures -->
                <div class="help-section">
                    <h3>üìê Syllogistic Figures</h3>
                    <p>A syllogism's figure is determined by the position of the Middle Term (M) in the premises:</p>
                    <table class="help-table">
                        <thead>
                            <tr>
                                <th>Figure</th>
                                <th>Major Premise</th>
                                <th>Minor Premise</th>
                                <th>Pattern</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Figure 1</strong></td>
                                <td>M - P</td>
                                <td>S - M</td>
                                <td>Middle is subject of major, predicate of minor</td>
                            </tr>
                            <tr>
                                <td><strong>Figure 2</strong></td>
                                <td>P - M</td>
                                <td>S - M</td>
                                <td>Middle is predicate of both</td>
                            </tr>
                            <tr>
                                <td><strong>Figure 3</strong></td>
                                <td>M - P</td>
                                <td>M - S</td>
                                <td>Middle is subject of both</td>
                            </tr>
                            <tr>
                                <td><strong>Figure 4</strong></td>
                                <td>P - M</td>
                                <td>M - S</td>
                                <td>Middle is predicate of major, subject of minor</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Sorites Section -->
                <div class="help-section">
                    <h3>üîó Sorites (Chain Syllogisms)</h3>
                    <p>A <strong>sorites</strong> (from Greek "heap") is an extended chain of syllogistic reasoning consisting of three or more premises that lead directly to a conclusion by omitting intermediate conclusions. It's essentially a series of syllogisms linked together where the conclusion of one becomes a premise of the next.</p>
                    
                    <div class="help-sorites-box">
                        <h4>üìñ Example of a Sorites</h4>
                        <div class="help-sorites-example">
                            <div class="premise">1. All A are B</div>
                            <div class="premise">2. All B are C</div>
                            <div class="premise">3. All C are D</div>
                            <div class="premise">4. All D are E</div>
                            <div class="conclusion">‚à¥ All A are E</div>
                        </div>
                        <p>This sorites contains three hidden syllogisms:</p>
                        <ul>
                            <li><strong>Syllogism 1:</strong> All A are B, All B are C ‚Üí All A are C</li>
                            <li><strong>Syllogism 2:</strong> All A are C, All C are D ‚Üí All A are D</li>
                            <li><strong>Syllogism 3:</strong> All A are D, All D are E ‚Üí All A are E</li>
                        </ul>
                    </div>

                    <h4>üõ†Ô∏è Using the Platform for Sorites</h4>
                    <p>This platform provides special features to help you analyze sorites step by step:</p>
                    
                    <div class="help-tip">
                        <p><strong>In Statement Mode:</strong></p>
                        <ul style="margin-top: 8px; margin-left: 20px;">
                            <li><strong>"Premise ‚Üí Syllogism P1"</strong> - Copies the current statement to Premise 1 of the Syllogism</li>
                            <li><strong>"Premise ‚Üí Syllogism P2"</strong> - Copies the current statement to Premise 2 of the Syllogism</li>
                        </ul>
                    </div>
                    
                    <div class="help-tip">
                        <p><strong>In Syllogism Mode:</strong></p>
                        <ul style="margin-top: 8px; margin-left: 20px;">
                            <li><strong>"Conclusion ‚Üí P1"</strong> - Copies the conclusion to Premise 1, allowing you to chain syllogisms</li>
                        </ul>
                    </div>

                    <h4>üìã Step-by-Step Sorites Analysis</h4>
                    <ol style="margin-left: 20px; color: #475569; line-height: 1.8;">
                        <li>Enter your first two premises in <strong>Statement Mode</strong> and copy them to the Syllogism using the copy buttons</li>
                        <li>Switch to <strong>Syllogism Mode</strong> and set up your conclusion</li>
                        <li>Check the validity of the first syllogism</li>
                        <li>Click <strong>"Conclusion ‚Üí P1"</strong> to move the intermediate conclusion to Premise 1</li>
                        <li>Enter the next premise from your sorites into Premise 2</li>
                        <li>Set the new conclusion and check validity</li>
                        <li>Repeat until you reach the final conclusion</li>
                    </ol>

                    <div class="help-warning">
                        <p>‚ö†Ô∏è <strong>Important:</strong> For a sorites to be valid, EVERY constituent syllogism must be valid. If any step fails, the entire sorites is invalid.</p>
                    </div>
                </div>

                <!-- How to Use -->
                <div class="help-section">
                    <h3>üéØ How to Use the Platform</h3>
                    
                    <h4>Step 1: Enter Propositions</h4>
                    <ul>
                        <li>In <strong>Statement Mode</strong>: Enter subject and predicate terms for a single premise</li>
                        <li>In <strong>Syllogism Mode</strong>: Enter terms for both premises (the system requires exactly 3 unique terms)</li>
                        <li>Select quantifiers (All/Some) and copulas (are/are not) from dropdowns</li>
                        <li>The conclusion terms are automatically populated from your premises</li>
                    </ul>

                    <h4>Step 2: Select Conclusion Terms</h4>
                    <ul>
                        <li>Choose the subject and predicate for your conclusion from the dropdown menus</li>
                        <li>The system will automatically identify Major, Minor, and Middle terms</li>
                        <li>Premise labels update to show which is the Major Premise and which is the Minor Premise</li>
                    </ul>

                    <h4>Step 3: Check Validity (Syllogism Mode)</h4>
                    <ul>
                        <li>Click <strong>"Check Validity"</strong> to determine if your syllogism is valid</li>
                        <li>Results show the mood-figure code (e.g., AAA-1), traditional name (e.g., Barbara), and validity status</li>
                        <li>Green = Unconditionally Valid, Yellow = Conditionally Valid (Aristotelian), Red = Invalid</li>
                    </ul>

                    <h4>Step 4: Use the Proving Table</h4>
                    <ul>
                        <li>Manually test each validity rule by selecting YES/NO in the Answer column</li>
                        <li>Or click <strong>"System Proving"</strong> to have the system automatically check all rules</li>
                        <li>Any NO answer indicates a fallacy (shown in the Fallacy column)</li>
                    </ul>
                </div>

                <!-- Venn Diagram -->
                <div class="help-section">
                    <h3>üé® Using the Diagram Canvas</h3>
                    <p>The diagram canvas supports both mouse/trackpad and touch/finger interactions:</p>
                    
                    <h4>üñ±Ô∏è Desktop (Mouse/Trackpad)</h4>
                    <ul>
                        <li><strong>Click on regions</strong> to color them with the selected color (shading represents empty areas)</li>
                        <li><strong>Drag circles</strong> from their center to reposition them</li>
                        <li><strong>Drag circle edges</strong> to resize circles</li>
                        <li><strong>Drag existence markers (X)</strong> to move them</li>
                    </ul>
                    
                    <h4>üì± Mobile/Tablet (Touch/Finger)</h4>
                    <ul>
                        <li><strong>Tap on regions</strong> to color them with the selected color</li>
                        <li><strong>Touch and drag circles</strong> from their center to reposition them</li>
                        <li><strong>Touch and drag circle edges</strong> to resize circles</li>
                        <li><strong>Touch and drag existence markers (X)</strong> to move them</li>
                        <li><strong>Swipe across regions</strong> to paint multiple areas in one motion</li>
                    </ul>
                    
                    <h4>Common Controls</h4>
                    <ul>
                        <li><strong>Add Existence markers</strong> (X) to indicate that members exist in a region</li>
                        <li><strong>Toggle Boolean/Aristotelian</strong> to switch between logical systems</li>
                        <li>Use the <strong>color palette</strong> to select different colors for shading</li>
                        <li>Use <strong>"Clear All"</strong> to reset the diagram colors</li>
                    </ul>
                    
                    <div class="help-tip">
                        <p>üí° <strong>Tip:</strong> On touch devices, use a stylus for more precise control when painting small regions.</p>
                    </div>
                    
                    <div class="help-warning">
                        <p>‚ö†Ô∏è <strong>Note:</strong> Diagram 1 and Diagram 2 are separate canvases. Changes to one do not affect the other. Use them for comparing different representations!</p>
                    </div>
                </div>

                <!-- Validity Rules -->
                <div class="help-section">
                    <h3>‚úÖ Syllogism Validity Rules</h3>
                    <p>A valid syllogism must satisfy ALL of the following six fundamental rules:</p>
                    <table class="help-table">
                        <thead>
                            <tr>
                                <th>Rule</th>
                                <th>Requirement</th>
                                <th>Fallacy if Violated</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Three Terms</strong></td>
                                <td>Exactly three distinct terms used consistently</td>
                                <td>Fallacy of Four Terms</td>
                            </tr>
                            <tr>
                                <td><strong>Middle Term Distribution</strong></td>
                                <td>Middle term must be distributed at least once</td>
                                <td>Undistributed Middle</td>
                            </tr>
                            <tr>
                                <td><strong>Conclusion Distribution</strong></td>
                                <td>Terms distributed in conclusion must be distributed in premises</td>
                                <td>Illicit Major/Minor</td>
                            </tr>
                            <tr>
                                <td><strong>Exclusive Premises</strong></td>
                                <td>Cannot have two negative premises</td>
                                <td>Fallacy of Exclusive Premises</td>
                            </tr>
                            <tr>
                                <td><strong>Negative Matches</strong></td>
                                <td>Negative premise requires negative conclusion; affirmative premises require affirmative conclusion</td>
                                <td>Drawing wrong quality conclusion</td>
                            </tr>
                            <tr>
                                <td><strong>Existential Rule</strong></td>
                                <td>Particular conclusion from universal premises requires existential assumption</td>
                                <td>Existential Fallacy</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Derived Shortcut Rules -->
                    <div class="help-subsection">
                        <h4>‚ö° Why Only 6 Rules? Understanding Derived Shortcuts</h4>
                        <p>You may have encountered two additional "rules" in some textbooks. These are actually <strong>shortcuts derived from the 6 fundamental rules</strong> above. The platform checks the 6 core rules because they identify the <em>exact reason</em> an argument fails. These two shortcuts are just helpful symptoms of those deeper logical errors:</p>
                        
                        <table class="help-table-shortcut">
                            <thead>
                                <tr>
                                    <th>Shortcut Rule</th>
                                    <th>What It Says</th>
                                    <th>Why It's Not Fundamental</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Two Particulars Rule</strong></td>
                                    <td>If both premises start with "Some...", no valid conclusion can follow.</td>
                                    <td>This is a <em>combination</em> of other rules. Two "Some" statements never provide enough "Distribution Credits" to properly link the terms. One will always trigger an <strong>Undistributed Middle</strong> or an <strong>Illicit Process</strong>.</td>
                                </tr>
                                <tr>
                                    <td><strong>Particular Conclusion Corollary</strong></td>
                                    <td>If one premise is Particular ("Some..."), your conclusion must also be Particular. You cannot move from a specific observation to a universal "All" or "No" statement.</td>
                                    <td>If you try to draw a Universal conclusion from one Particular premise, you will mathematically run out of distributed terms. The platform will catch this specifically as an <strong>Illicit Major</strong> or <strong>Illicit Minor</strong>.</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="help-derivation-box">
                            <p><strong>üí° Key Insight:</strong> These shortcuts are useful for quickly spotting invalid arguments, but the 6 fundamental rules tell you <em>precisely what went wrong</em>. That's why experienced logicians use shortcuts to flag problems, but rely on the core rules for rigorous analysis.</p>
                        </div>
                    </div>
                </div>

                <!-- Web Search -->
                <div class="help-section">
                    <h3>üîé Web Search Feature</h3>
                    <p>The Web Search section allows you to quickly search for more information about syllogistic forms:</p>
                    <ul>
                        <li>The search query automatically updates based on the current validity check result</li>
                        <li>Click <strong>"Search"</strong> to open a Google search in a new tab</li>
                        <li>You can modify the search query before searching</li>
                    </ul>
                </div>

                <!-- Keyboard Shortcuts -->
                <div class="help-section">
                    <h3>‚å®Ô∏è Tips &amp; Best Practices</h3>
                    <ul>
                        <li>Use consistent terminology when entering terms (case-insensitive)</li>
                        <li>The system automatically detects E-type propositions and shows the alternative "No S is P" notation</li>
                        <li>Resize the left panel by dragging the divider for more workspace</li>
                        <li>Use the Reset button to clear all inputs and start fresh (each mode has independent reset)</li>
                        <li>Check the Knowledge Table at the bottom for quick reference to proposition types and figures</li>
                        <li><strong>On mobile devices:</strong> Use landscape orientation for better diagram visibility</li>
                    </ul>
                </div>

                <!-- Credits -->
                <div class="help-section">
                    <h3>‚ÑπÔ∏è About</h3>
                    <div class="help-credits">
                        <div class="help-credits-grid">
                            <div class="help-credit-item">
                                <div class="label">Designer</div>
                                <div class="value">LAM Wai Ip ÊûóËë¶Ëëâ (HKU)</div>
                            </div>
                            <div class="help-credit-item">
                                <div class="label">Developer</div>
                                <div class="value">Claude-Opus 4.5 (Anthropic)</div>
                            </div>
                            <div class="help-credit-item">
                                <div class="label">Date</div>
                                <div class="value">February 14, 2026</div>
                            </div>
                            <div class="help-credit-item">
                                <div class="label">Version</div>
                                <div class="value">30</div>
                            </div>
                        </div>

                        <div class="help-license">
                            <h4>üìú License &amp; Citation</h4>
                            <p>This application is provided free of charge for educational and research purposes.</p>
                            <p>If you use this application in your research or teaching, please cite:</p>
                            <div class="help-citation">
                                Lam, W. I. (2026). Syllogiser: A Venn and Euler Diagram Tool for Categorical Logic.
                            </div>
                        </div>

                        <div class="help-contact">
                            <h4>üìß Feedback &amp; Support</h4>
                            <p>For questions, bug reports, feature requests, or collaboration opportunities, please contact:</p>
                            <p>üìß Official Website: <a href="https://web.edu.hku.hk/faculty-academics/jwilam" target="_blank">web.edu.hku.hk/faculty-academics/jwilam</a></p>
                            <p>üìß Official Email: <a href="mailto:jwilam@hku.hk">jwilam@hku.hk</a></p>
                            <p>üìß Personal Website: <a href="https://jwilam.com" target="_blank">jwilam.com</a></p>
                            <p>üìß Personal Email: <a href="mailto:jwilam@gmail.com">jwilam@gmail.com</a></p>
                            <p style="margin-top: 12px; color: #64748b; font-style: italic;">We welcome your feedback to improve this platform! Report bugs, suggest features, or share your use cases.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="left-panel" id="leftPanel">
            <div class="title-container">
                <h1>Syllogiser - Statement &amp; Syllogism Visualiser</h1>
                <button class="help-btn" onclick="openHelpModal()">
                    ‚ùì Help
                </button>
            </div>
            
            <!-- Mode Toggle -->
            <div class="mode-toggle-container">
                <span class="mode-label" id="statementLabel">Statement</span>
                <div class="mode-toggle" id="modeToggle" onclick="toggleMode()">
                    <div class="mode-toggle-slider"></div>
                </div>
                <span class="mode-label active" id="syllogismLabel">Syllogism</span>
            </div>

            <!-- Syllogism Header -->
            <div class="header-row" id="syllogismHeader">
                <h2>Propositions</h2>
                <div class="button-group">
                    <button class="reset-btn" onclick="resetSyllogism()">
                        üîÑ Reset
                    </button>
                    <button class="copy-btn green" onclick="copyConclusionToPremise1()">
                        üìã Conclusion ‚Üí P1
                    </button>
                </div>
            </div>

            <!-- Statement Header -->
            <div class="header-row hidden" id="statementHeader">
                <h2>Propositions</h2>
                <div class="button-group">
                    <button class="reset-btn" onclick="resetStatement()">
                        üîÑ Reset
                    </button>
                    <button class="copy-btn" onclick="copyToPremise1()">
                        üìã Premise ‚Üí Syllogism P1
                    </button>
                    <button class="copy-btn" onclick="copyToPremise2()">
                        üìã Premise ‚Üí Syllogism P2
                    </button>
                </div>
            </div>
            
            <!-- Syllogism Table -->
            <table class="proposition-table" id="syllogismTable">
                <thead>
                    <tr>
                        <th>TERM</th>
                        <th>QUANTIFIER</th>
                        <th>SUBJECT</th>
                        <th>COPULA</th>
                        <th>PREDICATE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="premise1Row">
                        <td><span class="term-label" id="premise1Label">PREMISE 1</span></td>
                        <td class="quantifier-cell">
                            <select id="premise1Quantifier" onchange="handleQuantifierCopulaChange()">
                                <option value="All">All</option>
                                <option value="Some">Some</option>
                            </select>
                            <span class="alternative-quantifier" id="premise1AltQuantifier"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="premise1Subject" placeholder="e.g., men" oninput="handlePremiseInput()">
                            <span class="distribution-badge" id="premise1SubjectDist"></span>
                        </td>
                        <td class="copula-cell">
                            <select id="premise1Copula" onchange="handleQuantifierCopulaChange()">
                                <option value="are">are</option>
                                <option value="are not">are not</option>
                            </select>
                            <span class="alternative-expression" id="premise1AltCopula"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="premise1Predicate" placeholder="e.g., mortal" oninput="handlePremiseInput()">
                            <span class="distribution-badge" id="premise1PredicateDist"></span>
                        </td>
                    </tr>
                    <tr id="premise2Row">
                        <td><span class="term-label" id="premise2Label">PREMISE 2</span></td>
                        <td class="quantifier-cell">
                            <select id="premise2Quantifier" onchange="handleQuantifierCopulaChange()">
                                <option value="All">All</option>
                                <option value="Some">Some</option>
                            </select>
                            <span class="alternative-quantifier" id="premise2AltQuantifier"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="premise2Subject" placeholder="e.g., Greeks" oninput="handlePremiseInput()">
                            <span class="distribution-badge" id="premise2SubjectDist"></span>
                        </td>
                        <td class="copula-cell">
                            <select id="premise2Copula" onchange="handleQuantifierCopulaChange()">
                                <option value="are">are</option>
                                <option value="are not">are not</option>
                            </select>
                            <span class="alternative-expression" id="premise2AltCopula"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="premise2Predicate" placeholder="e.g., men" oninput="handlePremiseInput()">
                            <span class="distribution-badge" id="premise2PredicateDist"></span>
                        </td>
                    </tr>
                    <tr id="conclusionRowSyllogism">
                        <td>CONCLUSION</td>
                        <td class="quantifier-cell">
                            <select id="conclusionQuantifier" onchange="handleQuantifierCopulaChange()">
                                <option value="All">All</option>
                                <option value="Some">Some</option>
                            </select>
                            <span class="alternative-quantifier" id="conclusionAltQuantifier"></span>
                        </td>
                        <td class="term-cell">
                            <select id="conclusionSubject" onchange="handleConclusionChange()">
                                <option value="">Select...</option>
                            </select>
                            <span class="distribution-badge" id="conclusionSubjectDist"></span>
                        </td>
                        <td class="copula-cell">
                            <select id="conclusionCopula" onchange="handleQuantifierCopulaChange()">
                                <option value="are">are</option>
                                <option value="are not">are not</option>
                            </select>
                            <span class="alternative-expression" id="conclusionAltCopula"></span>
                        </td>
                        <td class="term-cell">
                            <select id="conclusionPredicate" onchange="handleConclusionChange()">
                                <option value="">Select...</option>
                            </select>
                            <span class="distribution-badge" id="conclusionPredicateDist"></span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Statement Table -->
            <table class="proposition-table statement-mode hidden" id="statementTable">
                <thead>
                    <tr>
                        <th>TERM</th>
                        <th>QUANTIFIER</th>
                        <th>SUBJECT</th>
                        <th>COPULA</th>
                        <th>PREDICATE</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="statementPremiseRow">
                        <td>PREMISE</td>
                        <td class="quantifier-cell">
                            <select id="statementPremiseQuantifier" onchange="handleStatementChange()">
                                <option value="All">All</option>
                                <option value="Some">Some</option>
                            </select>
                            <span class="alternative-quantifier" id="statementPremiseAltQuantifier"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="statementPremiseSubject" placeholder="e.g., dogs" oninput="handleStatementChange()">
                            <span class="distribution-badge" id="statementPremiseSubjectDist"></span>
                        </td>
                        <td class="copula-cell">
                            <select id="statementPremiseCopula" onchange="handleStatementChange()">
                                <option value="are">are</option>
                                <option value="are not">are not</option>
                            </select>
                            <span class="alternative-expression" id="statementPremiseAltCopula"></span>
                        </td>
                        <td class="term-cell">
                            <input type="text" id="statementPremisePredicate" placeholder="e.g., animals" oninput="handleStatementChange()">
                            <span class="distribution-badge" id="statementPremisePredicateDist"></span>
                        </td>
                    </tr>
                    <tr id="statementConclusionRow">
                        <td>CONCLUSION</td>
                        <td class="quantifier-cell">
                            <select id="statementConclusionQuantifier" onchange="handleStatementChange()">
                                <option value="All">All</option>
                                <option value="Some">Some</option>
                            </select>
                            <span class="alternative-quantifier" id="statementConclusionAltQuantifier"></span>
                        </td>
                        <td class="term-cell">
                            <select id="statementConclusionSubject" onchange="handleStatementChange()">
                                <option value="">Select...</option>
                            </select>
                            <span class="distribution-badge" id="statementConclusionSubjectDist"></span>
                        </td>
                        <td class="copula-cell">
                            <select id="statementConclusionCopula" onchange="handleStatementChange()">
                                <option value="are">are</option>
                                <option value="are not">are not</option>
                            </select>
                            <span class="alternative-expression" id="statementConclusionAltCopula"></span>
                        </td>
                        <td class="term-cell">
                            <select id="statementConclusionPredicate" onchange="handleStatementChange()">
                                <option value="">Select...</option>
                            </select>
                            <span class="distribution-badge" id="statementConclusionPredicateDist"></span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box" id="warningBox">
                <h4>‚ö†Ô∏è Validation Warnings</h4>
                <ul id="warningList"></ul>
            </div>

            <div class="validation-success" id="successBox">
                ‚úì All validation rules passed.
            </div>

            <!-- Syllogism Type Display -->
            <div class="type-display" id="syllogismTypeDisplay">
                <div class="type-item">
                    <div class="type-label" id="majorTypeLabel">Premise 1 Type</div>
                    <div class="type-value" id="premise1Type">A</div>
                </div>
                <div class="type-item">
                    <div class="type-label" id="minorTypeLabel">Premise 2 Type</div>
                    <div class="type-value" id="premise2Type">A</div>
                </div>
                <div class="type-item">
                    <div class="type-label">Conclusion Type</div>
                    <div class="type-value" id="conclusionType">A</div>
                </div>
            </div>

            <!-- Statement Type Display -->
            <div class="type-display statement-mode hidden" id="statementTypeDisplay">
                <div class="type-item">
                    <div class="type-label">Premise Type</div>
                    <div class="type-value" id="statementPremiseType">A</div>
                </div>
                <div class="type-item">
                    <div class="type-label">Conclusion Type</div>
                    <div class="type-value" id="statementConclusionType">A</div>
                </div>
            </div>

            <!-- Syllogism-only section -->
            <div id="syllogismOnlySection">
                <button class="check-validity-btn" id="checkValidityBtn">
                    üîç Check Validity
                </button>

                <div class="validity-display pending" id="validityDisplay">
                    <div class="validity-form-code" id="validityFormCode">?</div>
                    <div class="validity-name" id="validityName">Is it Valid?</div>
                    <div class="validity-badge" id="validityBadge">Click to Check</div>
                    <div class="validity-note" id="validityNote">Fill in the syllogism and click "Check Validity" to determine if it's a valid form.</div>
                </div>

                <!-- Proving Section -->
                <div class="proving-section">
                    <h3>üìã Proving</h3>
                    <table class="proving-table">
                        <thead>
                            <tr>
                                <th>Rules</th>
                                <th>Proof</th>
                                <th>Answer</th>
                                <th>Fallacy for NO</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Three Terms</td>
                                <td>Does the argument have exactly three distinct terms used consistently, or is there a "four-term" ambiguity?</td>
                                <td>
                                    <select id="proofThreeTerms" onchange="updateFallacyDisplay('threeTerms')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyThreeTerms">Fallacy of Four Terms (Quaternio Terminorum)</span></td>
                            </tr>
                            <tr>
                                <td>Middle Term Distribution</td>
                                <td>Is the Middle Term distributed (covering its entire category) in at least one of the premises?</td>
                                <td>
                                    <select id="proofMiddleTerm" onchange="updateFallacyDisplay('middleTerm')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyMiddleTerm">Undistributed Middle</span></td>
                            </tr>
                            <tr>
                                <td>Conclusion Distribution</td>
                                <td>If a term (Major or Minor) is distributed in the conclusion, was it also distributed back in the premise?</td>
                                <td>
                                    <select id="proofConclusionDist" onchange="updateFallacyDisplay('conclusionDist')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyConclusionDist">Illicit Major or Illicit Minor</span></td>
                            </tr>
                            <tr>
                                <td>Exclusive Premises</td>
                                <td>Are the premises NOT both negative? (Two negative premises cannot establish any valid conclusion)</td>
                                <td>
                                    <select id="proofAffirmative" onchange="updateFallacyDisplay('affirmative')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyAffirmative">Fallacy of Exclusive Premises</span></td>
                            </tr>
                            <tr>
                                <td>Negative Matches</td>
                                <td>Does the quality of the conclusion match the premises? (Negative premise ‚Üí Negative conclusion; All affirmative premises ‚Üí Affirmative conclusion)</td>
                                <td>
                                    <select id="proofNegative" onchange="updateFallacyDisplay('negative')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyNegative">Drawing Affirmative Conclusion from Negative Premise / Drawing Negative Conclusion from Affirmative Premises</span></td>
                            </tr>
                            <tr>
                                <td>Existential Rule</td>
                                <td>If the conclusion is particular (starts with "Some"), is there at least one particular premise, or are you assuming something exists that isn't stated?</td>
                                <td>
                                    <select id="proofExistential" onchange="updateFallacyDisplay('existential')">
                                        <option value="">--</option>
                                        <option value="YES">YES</option>
                                        <option value="NO">NO</option>
                                    </select>
                                </td>
                                <td><span class="fallacy-text" id="fallacyExistential">Existential Fallacy</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <button class="system-proving-btn" id="systemProvingBtn" onclick="systemProving()">
                        ü§ñ System Proving
                    </button>
                </div>

                <!-- Web Search Section -->
                <div class="search-section">
                    <h3>üîé Web Search</h3>
                    <div class="search-container">
                        <input type="text" class="search-input" id="searchInput" value="Is AAA-1 valid in syllogism? Please give me examples.">
                        <button class="search-btn" onclick="performWebSearch()">
                            üåê Search
                        </button>
                    </div>
                </div>
            </div>

            <!-- Syllogism Knowledge Table -->
            <table class="knowledge-table" id="knowledgeTable">
                <thead>
                    <tr>
                        <th>Proposition Types</th>
                        <th>Syllogistic Figures</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="knowledge-item"><strong>A</strong> (Universal Affirmative):<br>All S are P<br><em>S: Distributed, P: Undistributed</em></div>
                            <div class="knowledge-item"><strong>E</strong> (Universal Negative):<br>No S are P<br><em>S: Distributed, P: Distributed</em></div>
                            <div class="knowledge-item"><strong>I</strong> (Particular Affirmative):<br>Some S are P<br><em>S: Undistributed, P: Undistributed</em></div>
                            <div class="knowledge-item"><strong>O</strong> (Particular Negative):<br>Some S are not P<br><em>S: Undistributed, P: Distributed</em></div>
                        </td>
                        <td>
                            <div class="figure-title">Figure 1:</div>
                            <div class="knowledge-item">Middle term is subject of major premise and predicate of minor premise.<br>Pattern: <span class="figure-pattern">M-P, S-M</span></div>
                            
                            <div class="figure-title">Figure 2:</div>
                            <div class="knowledge-item">Middle term is predicate of both premises.<br>Pattern: <span class="figure-pattern">P-M, S-M</span></div>
                            
                            <div class="figure-title">Figure 3:</div>
                            <div class="knowledge-item">Middle term is subject of both premises.<br>Pattern: <span class="figure-pattern">M-P, M-S</span></div>
                            
                            <div class="figure-title">Figure 4:</div>
                            <div class="knowledge-item">Middle term is predicate of major premise and subject of minor premise.<br>Pattern: <span class="figure-pattern">P-M, M-S</span></div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Statement Proposition Types Info Table -->
            <table class="proposition-types-info hidden" id="statementKnowledgeTable">
                <thead>
                    <tr>
                        <th>Proposition Types</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <div class="knowledge-item"><strong>A</strong> (Universal Affirmative):<br>All S are P<br><em>S: Distributed, P: Undistributed</em></div>
                            <div class="knowledge-item"><strong>E</strong> (Universal Negative):<br>No S are P<br><em>S: Distributed, P: Distributed</em></div>
                            <div class="knowledge-item"><strong>I</strong> (Particular Affirmative):<br>Some S are P<br><em>S: Undistributed, P: Undistributed</em></div>
                            <div class="knowledge-item"><strong>O</strong> (Particular Negative):<br>Some S are not P<br><em>S: Undistributed, P: Distributed</em></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="resizer" id="resizer"></div>

        <div class="right-panel" id="rightPanel">
            <!-- Tab Navigation -->
            <div class="tab-container">
                <button class="tab-btn premises active" onclick="switchTab('premises')" id="premisesTabBtn">
                    <span class="tab-icon">üìê</span><span id="premisesTabLabel">Diagram 1 (e.g. Premise)</span>
                </button>
                <button class="tab-btn conclusion" onclick="switchTab('conclusion')">
                    <span class="tab-icon">üéØ</span>Diagram 2 (e.g. Conclusion)
                </button>
            </div>

            <!-- Premises Tab Content -->
            <div class="tab-content active" id="premisesTab">
                <div class="toolbar">
                    <!-- Row 1: Color palette -->
                    <div class="toolbar-row">
                        <div class="color-palette" id="colorPalettePremises">
                            <button class="color-btn selected" style="background: #3b82f6;" data-color="#3b82f6" onclick="selectColor(this, 'premises')" title="Blue"></button>
                            <button class="color-btn" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor(this, 'premises')" title="Red"></button>
                            <button class="color-btn" style="background: #22c55e;" data-color="#22c55e" onclick="selectColor(this, 'premises')" title="Green"></button>
                            <button class="color-btn" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor(this, 'premises')" title="Amber"></button>
                            <button class="color-btn" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor(this, 'premises')" title="Purple"></button>
                            <button class="color-btn" style="background: #06b6d4;" data-color="#06b6d4" onclick="selectColor(this, 'premises')" title="Cyan"></button>
                            <button class="color-btn" style="background: #ec4899;" data-color="#ec4899" onclick="selectColor(this, 'premises')" title="Pink"></button>
                            <button class="color-btn" style="background: #000000;" data-color="#000000" onclick="selectColor(this, 'premises')" title="Black"></button>
                            <button class="color-btn" style="background: #6b7280;" data-color="#6b7280" onclick="selectColor(this, 'premises')" title="Grey"></button>
                            <button class="color-btn" style="background: #ffffff; border: 2px solid #ccc;" data-color="transparent" onclick="selectColor(this, 'premises')" title="White/Clear"></button>
                            <button class="clear-btn" onclick="clearColors('premises')">Clear All</button>
                        </div>
                    </div>
                    <!-- Row 2: Existence buttons and logic toggle -->
                    <div class="toolbar-row">
                        <div class="toolbar-section">
                            <button class="toolbar-btn" onclick="addExistence('premises')">Add Existence</button>
                            <button class="toolbar-btn danger" onclick="clearExistence('premises')">Clear Existence</button>
                        </div>
                        <div class="divider"></div>
                        <div class="toggle-container">
                            <div class="toggle-switch" id="logicTogglePremises" onclick="toggleLogic('premises')">
                                <div class="toggle-slider" id="toggleSliderPremises">Boolean</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="canvas-container">
                    <canvas id="vennCanvasPremises" class="venn-canvas"></canvas>
                </div>
            </div>

            <!-- Conclusion Tab Content -->
            <div class="tab-content" id="conclusionTab">
                <div class="toolbar">
                    <!-- Row 1: Color palette -->
                    <div class="toolbar-row">
                        <div class="color-palette" id="colorPaletteConclusion">
                            <button class="color-btn selected" style="background: #3b82f6;" data-color="#3b82f6" onclick="selectColor(this, 'conclusion')" title="Blue"></button>
                            <button class="color-btn" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor(this, 'conclusion')" title="Red"></button>
                            <button class="color-btn" style="background: #22c55e;" data-color="#22c55e" onclick="selectColor(this, 'conclusion')" title="Green"></button>
                            <button class="color-btn" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor(this, 'conclusion')" title="Amber"></button>
                            <button class="color-btn" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor(this, 'conclusion')" title="Purple"></button>
                            <button class="color-btn" style="background: #06b6d4;" data-color="#06b6d4" onclick="selectColor(this, 'conclusion')" title="Cyan"></button>
                            <button class="color-btn" style="background: #ec4899;" data-color="#ec4899" onclick="selectColor(this, 'conclusion')" title="Pink"></button>
                            <button class="color-btn" style="background: #000000;" data-color="#000000" onclick="selectColor(this, 'conclusion')" title="Black"></button>
                            <button class="color-btn" style="background: #6b7280;" data-color="#6b7280" onclick="selectColor(this, 'conclusion')" title="Grey"></button>
                            <button class="color-btn" style="background: #ffffff; border: 2px solid #ccc;" data-color="transparent" onclick="selectColor(this, 'conclusion')" title="White/Clear"></button>
                            <button class="clear-btn" onclick="clearColors('conclusion')">Clear All</button>
                        </div>
                    </div>
                    <!-- Row 2: Existence buttons and logic toggle -->
                    <div class="toolbar-row">
                        <div class="toolbar-section">
                            <button class="toolbar-btn" onclick="addExistence('conclusion')">Add Existence</button>
                            <button class="toolbar-btn danger" onclick="clearExistence('conclusion')">Clear Existence</button>
                        </div>
                        <div class="divider"></div>
                        <div class="toggle-container">
                            <div class="toggle-switch" id="logicToggleConclusion" onclick="toggleLogic('conclusion')">
                                <div class="toggle-slider" id="toggleSliderConclusion">Boolean</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="canvas-container">
                    <canvas id="vennCanvasConclusion" class="venn-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // TOAST NOTIFICATION
        // ============================================
        
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // ============================================
        // LAYOUT SETTING
        // ============================================
        
        let diagramLayout = 'upright'; // 'upright' or 'inverted'
        
        function setLayout(layout) {
            diagramLayout = layout;
            
            // Update UI in help modal
            document.getElementById('layoutUpright').classList.remove('selected');
            document.getElementById('layoutInverted').classList.remove('selected');
            document.getElementById('layout' + layout.charAt(0).toUpperCase() + layout.slice(1)).classList.add('selected');
            
            // Apply layout to both canvases
            applyLayoutToBothCanvases();
        }
        
        function applyLayoutToBothCanvases() {
            // Apply to both canvases, calculating positions based on stored or default dimensions
            ['premises', 'conclusion'].forEach(tabName => {
                const state = canvasStates[tabName];
                const canvas = canvases[tabName];
                
                // Get the actual or expected canvas dimensions
                let width, height;
                
                if (canvas.width > 0 && canvas.height > 0) {
                    width = canvas.width;
                    height = canvas.height;
                } else {
                    // Use default dimensions if canvas isn't properly sized yet
                    width = 600;
                    height = 400;
                }
                
                const centerX = width / 2;
                const centerY = height / 2;
                
                // Position circles based on mode and layout
                if (currentMode === 'statement' || state.circles.length === 2) {
                    state.circles[0].x = centerX - 80;
                    state.circles[0].y = centerY;
                    state.circles[1].x = centerX + 80;
                    state.circles[1].y = centerY;
                } else {
                    // Three circles for syllogism mode
                    if (diagramLayout === 'upright') {
                        // Upright: M on top
                        state.circles[0].x = centerX - 80;
                        state.circles[0].y = centerY + 50;
                        state.circles[1].x = centerX + 80;
                        state.circles[1].y = centerY + 50;
                        state.circles[2].x = centerX;
                        state.circles[2].y = centerY - 70;
                    } else {
                        // Inverted: M on bottom
                        state.circles[0].x = centerX - 80;
                        state.circles[0].y = centerY - 50;
                        state.circles[1].x = centerX + 80;
                        state.circles[1].y = centerY - 50;
                        state.circles[2].x = centerX;
                        state.circles[2].y = centerY + 70;
                    }
                }
                
                // Mark as initialized so resizeCanvas won't override
                state.initialized = true;
            });
            
            // Redraw the active canvas immediately
            draw(activeTab);
            
            // Also redraw the other canvas if it has proper dimensions
            const otherTab = activeTab === 'premises' ? 'conclusion' : 'premises';
            if (canvases[otherTab].width > 0 && canvases[otherTab].height > 0) {
                draw(otherTab);
            }
        }

        // ============================================
        // HELP MODAL FUNCTIONS
        // ============================================
        
        function openHelpModal() {
            document.getElementById('helpModal').classList.add('visible');
            document.body.style.overflow = 'hidden';
        }
        
        function closeHelpModal() {
            document.getElementById('helpModal').classList.remove('visible');
            document.body.style.overflow = '';
        }
        
        // Close modal when clicking outside
        document.getElementById('helpModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeHelpModal();
            }
        });
        
        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeHelpModal();
            }
        });

        // ============================================
        // VALID SYLLOGISM FORMS DATABASE
        // ============================================
        
        const unconditionallyValid = {
            1: { 'AAA': 'Barbara', 'EAE': 'Celarent', 'AII': 'Darii', 'EIO': 'Ferio' },
            2: { 'EAE': 'Cesare', 'AEE': 'Camestres', 'EIO': 'Festino', 'AOO': 'Baroco' },
            3: { 'IAI': 'Disamis', 'AII': 'Datisi', 'OAO': 'Bocardo', 'EIO': 'Ferison' },
            4: { 'AEE': 'Camenes', 'IAI': 'Dimaris', 'EIO': 'Fresison' }
        };

        const conditionallyValid = {
            1: { 
                'AAI': { name: 'Barbari', condition: 'Requires S to exist' },
                'EAO': { name: 'Celaront', condition: 'Requires S to exist' }
            },
            2: { 
                'EAO': { name: 'Cesaro', condition: 'Requires S to exist' },
                'AEO': { name: 'Camestros', condition: 'Requires S to exist' }
            },
            3: { 
                'AAI': { name: 'Darapti', condition: 'Requires M to exist' },
                'EAO': { name: 'Felapton', condition: 'Requires M to exist' }
            },
            4: { 
                'AAI': { name: 'Bramantip', condition: 'Requires P to exist' },
                'EAO': { name: 'Fesapo', condition: 'Requires M to exist' },
                'AEO': { name: 'Calemos', condition: 'Requires S to exist' }
            }
        };

        // ============================================
        // MODE MANAGEMENT
        // ============================================
        
        let currentMode = 'syllogism'; // 'syllogism' or 'statement'

        function toggleMode() {
            currentMode = currentMode === 'syllogism' ? 'statement' : 'syllogism';
            
            const modeToggle = document.getElementById('modeToggle');
            const statementLabel = document.getElementById('statementLabel');
            const syllogismLabel = document.getElementById('syllogismLabel');
            const syllogismTable = document.getElementById('syllogismTable');
            const statementTable = document.getElementById('statementTable');
            const syllogismTypeDisplay = document.getElementById('syllogismTypeDisplay');
            const statementTypeDisplay = document.getElementById('statementTypeDisplay');
            const knowledgeTable = document.getElementById('knowledgeTable');
            const statementKnowledgeTable = document.getElementById('statementKnowledgeTable');
            const syllogismOnlySection = document.getElementById('syllogismOnlySection');
            const premisesTabLabel = document.getElementById('premisesTabLabel');
            const syllogismHeader = document.getElementById('syllogismHeader');
            const statementHeader = document.getElementById('statementHeader');
            
            if (currentMode === 'statement') {
                modeToggle.classList.add('statement-mode');
                statementLabel.classList.add('active');
                syllogismLabel.classList.remove('active');
                syllogismTable.classList.add('hidden');
                statementTable.classList.remove('hidden');
                syllogismTypeDisplay.classList.add('hidden');
                statementTypeDisplay.classList.remove('hidden');
                knowledgeTable.classList.add('hidden');
                statementKnowledgeTable.classList.remove('hidden');
                syllogismOnlySection.classList.add('hidden');
                premisesTabLabel.textContent = 'Diagram 1 (e.g. Premise)';
                syllogismHeader.classList.add('hidden');
                statementHeader.classList.remove('hidden');
            } else {
                modeToggle.classList.remove('statement-mode');
                statementLabel.classList.remove('active');
                syllogismLabel.classList.add('active');
                syllogismTable.classList.remove('hidden');
                statementTable.classList.add('hidden');
                syllogismTypeDisplay.classList.remove('hidden');
                statementTypeDisplay.classList.add('hidden');
                knowledgeTable.classList.remove('hidden');
                statementKnowledgeTable.classList.add('hidden');
                syllogismOnlySection.classList.remove('hidden');
                premisesTabLabel.textContent = 'Diagram 1 (e.g. Premises)';
                syllogismHeader.classList.remove('hidden');
                statementHeader.classList.add('hidden');
            }
            
            // Reset canvases for new mode
            resetCanvases();
            updateLabelsForMode();
        }

        function resetCanvases() {
            ['premises', 'conclusion'].forEach(tabName => {
                const state = canvasStates[tabName];
                state.regionColors = {};
                state.existenceMarkers = [];
                state.initialized = false;
                
                // Reset circle configuration based on mode
                if (currentMode === 'statement') {
                    state.circles = [
                        { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                        { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' }
                    ];
                } else {
                    state.circles = [
                        { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                        { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' },
                        { x: 0, y: 0, r: 120, label: 'Middle (M)', color: 'rgba(34, 197, 94, 0.1)', borderColor: '#22c55e' }
                    ];
                }
                
                resizeCanvas(tabName);
            });
        }

        function updateLabelsForMode() {
            if (currentMode === 'statement') {
                const subject = document.getElementById('statementPremiseSubject').value || 'Subject (S)';
                const predicate = document.getElementById('statementPremisePredicate').value || 'Predicate (P)';
                
                const sLabel = subject === 'Subject (S)' ? 'Subject (S)' : subject + ' (S)';
                const pLabel = predicate === 'Predicate (P)' ? 'Predicate (P)' : predicate + ' (P)';
                
                ['premises', 'conclusion'].forEach(tabName => {
                    canvasStates[tabName].circles[0].label = sLabel;
                    canvasStates[tabName].circles[1].label = pLabel;
                });
            }
            
            draw('premises');
            draw('conclusion');
        }

        // ============================================
        // COPY FUNCTIONS FOR SORITES
        // ============================================
        
        function copyToPremise1() {
            const quantifier = document.getElementById('statementPremiseQuantifier').value;
            const subject = document.getElementById('statementPremiseSubject').value;
            const copula = document.getElementById('statementPremiseCopula').value;
            const predicate = document.getElementById('statementPremisePredicate').value;
            
            document.getElementById('premise1Quantifier').value = quantifier;
            document.getElementById('premise1Subject').value = subject;
            document.getElementById('premise1Copula').value = copula;
            document.getElementById('premise1Predicate').value = predicate;
            
            // Update syllogism state
            handlePremiseInput();
            
            showToast('Copied to Syllogism Premise 1', 'success');
        }
        
        function copyToPremise2() {
            const quantifier = document.getElementById('statementPremiseQuantifier').value;
            const subject = document.getElementById('statementPremiseSubject').value;
            const copula = document.getElementById('statementPremiseCopula').value;
            const predicate = document.getElementById('statementPremisePredicate').value;
            
            document.getElementById('premise2Quantifier').value = quantifier;
            document.getElementById('premise2Subject').value = subject;
            document.getElementById('premise2Copula').value = copula;
            document.getElementById('premise2Predicate').value = predicate;
            
            // Update syllogism state
            handlePremiseInput();
            
            showToast('Copied to Syllogism Premise 2', 'success');
        }
        
        function copyConclusionToPremise1() {
            const quantifier = document.getElementById('conclusionQuantifier').value;
            const subject = document.getElementById('conclusionSubject').value;
            const copula = document.getElementById('conclusionCopula').value;
            const predicate = document.getElementById('conclusionPredicate').value;
            
            if (!subject || !predicate) {
                showToast('Please select conclusion terms first', 'info');
                return;
            }
            
            document.getElementById('premise1Quantifier').value = quantifier;
            document.getElementById('premise1Subject').value = subject;
            document.getElementById('premise1Copula').value = copula;
            document.getElementById('premise1Predicate').value = predicate;
            
            // Update syllogism state
            handlePremiseInput();
            
            showToast('Conclusion copied to Premise 1', 'success');
        }

        // ============================================
        // ALTERNATIVE EXPRESSION FOR E TYPE
        // ============================================
        
        function updateAlternativeExpressions() {
            // Syllogism mode
            updateRowAlternative('premise1');
            updateRowAlternative('premise2');
            updateRowAlternative('conclusion');
            
            // Statement mode
            updateRowAlternative('statementPremise');
            updateRowAlternative('statementConclusion');
        }
        
        function updateRowAlternative(rowPrefix) {
            const quantifierEl = document.getElementById(rowPrefix + 'Quantifier');
            const copulaEl = document.getElementById(rowPrefix + 'Copula');
            const altQuantifierEl = document.getElementById(rowPrefix + 'AltQuantifier');
            const altCopulaEl = document.getElementById(rowPrefix + 'AltCopula');
            
            if (!quantifierEl || !copulaEl || !altQuantifierEl || !altCopulaEl) return;
            
            const quantifier = quantifierEl.value;
            const copula = copulaEl.value;
            
            // Check if it's E type (All + are not)
            if (quantifier === 'All' && copula === 'are not') {
                altQuantifierEl.textContent = 'No';
                altCopulaEl.textContent = 'is';
            } else {
                altQuantifierEl.textContent = '';
                altCopulaEl.textContent = '';
            }
        }

        // ============================================
        // FALLACY DISPLAY UPDATE
        // ============================================
        
        function updateFallacyDisplay(ruleKey) {
            const idMap = {
                'threeTerms': { select: 'proofThreeTerms', fallacy: 'fallacyThreeTerms' },
                'middleTerm': { select: 'proofMiddleTerm', fallacy: 'fallacyMiddleTerm' },
                'conclusionDist': { select: 'proofConclusionDist', fallacy: 'fallacyConclusionDist' },
                'affirmative': { select: 'proofAffirmative', fallacy: 'fallacyAffirmative' },
                'negative': { select: 'proofNegative', fallacy: 'fallacyNegative' },
                'existential': { select: 'proofExistential', fallacy: 'fallacyExistential' }
            };
            
            const ids = idMap[ruleKey];
            if (!ids) return;
            
            const selectEl = document.getElementById(ids.select);
            const fallacyEl = document.getElementById(ids.fallacy);
            
            if (!selectEl || !fallacyEl) return;
            
            const answer = selectEl.value;
            
            fallacyEl.classList.remove('active-yes', 'active-no');
            
            if (answer === 'YES') {
                fallacyEl.classList.add('active-yes');
            } else if (answer === 'NO') {
                fallacyEl.classList.add('active-no');
            }
        }
        
        function updateAllFallacyDisplays() {
            ['threeTerms', 'middleTerm', 'conclusionDist', 'affirmative', 'negative', 'existential'].forEach(key => {
                updateFallacyDisplay(key);
            });
        }
        
        function resetProvingTable() {
            const proofSelects = [
                'proofThreeTerms', 'proofMiddleTerm', 'proofConclusionDist',
                'proofAffirmative', 'proofNegative', 'proofExistential'
            ];
            
            proofSelects.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            const fallacySpans = [
                'fallacyThreeTerms', 'fallacyMiddleTerm', 'fallacyConclusionDist',
                'fallacyAffirmative', 'fallacyNegative', 'fallacyExistential'
            ];
            
            fallacySpans.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.classList.remove('active-yes', 'active-no');
                }
            });
        }

        // ============================================
        // SYSTEM PROVING
        // ============================================
        
        function systemProving() {
            const premise1Subject = document.getElementById('premise1Subject').value.trim().toLowerCase();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim().toLowerCase();
            const premise2Subject = document.getElementById('premise2Subject').value.trim().toLowerCase();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim().toLowerCase();
            const conclusionSubject = document.getElementById('conclusionSubject').value.trim().toLowerCase();
            const conclusionPredicate = document.getElementById('conclusionPredicate').value.trim().toLowerCase();
            
            if (!premise1Subject || !premise1Predicate || !premise2Subject || !premise2Predicate ||
                !conclusionSubject || !conclusionPredicate) {
                alert('Please fill in all premise terms and select conclusion subject/predicate before running System Proving.');
                return;
            }
            
            const premise1Type = getPropositionType(
                document.getElementById('premise1Quantifier').value,
                document.getElementById('premise1Copula').value
            );
            const premise2Type = getPropositionType(
                document.getElementById('premise2Quantifier').value,
                document.getElementById('premise2Copula').value
            );
            const conclusionType = getPropositionType(
                document.getElementById('conclusionQuantifier').value,
                document.getElementById('conclusionCopula').value
            );
            
            const premise1Negative = (premise1Type === 'E' || premise1Type === 'O');
            const premise2Negative = (premise2Type === 'E' || premise2Type === 'O');
            const conclusionNegative = (conclusionType === 'E' || conclusionType === 'O');
            const conclusionAffirmative = !conclusionNegative;
            
            const negativeCount = (premise1Negative ? 1 : 0) + (premise2Negative ? 1 : 0);
            
            const allTerms = [premise1Subject, premise1Predicate, premise2Subject, premise2Predicate];
            const termCounts = {};
            allTerms.forEach(t => {
                termCounts[t] = (termCounts[t] || 0) + 1;
            });
            
            const majorTerm = conclusionPredicate;
            const minorTerm = conclusionSubject;
            let middleTerm = null;
            for (const [term, count] of Object.entries(termCounts)) {
                if (count >= 2 && term !== majorTerm && term !== minorTerm) {
                    middleTerm = term;
                    break;
                }
            }
            
            const premise1Terms = [premise1Subject, premise1Predicate];
            const premise2Terms = [premise2Subject, premise2Predicate];
            
            let majorPremiseType, minorPremiseType;
            let majorPremiseSubject, majorPremisePredicate;
            let minorPremiseSubject, minorPremisePredicate;
            
            if (premise1Terms.includes(majorTerm)) {
                majorPremiseType = premise1Type;
                majorPremiseSubject = premise1Subject;
                majorPremisePredicate = premise1Predicate;
                minorPremiseType = premise2Type;
                minorPremiseSubject = premise2Subject;
                minorPremisePredicate = premise2Predicate;
            } else {
                majorPremiseType = premise2Type;
                majorPremiseSubject = premise2Subject;
                majorPremisePredicate = premise2Predicate;
                minorPremiseType = premise1Type;
                minorPremiseSubject = premise1Subject;
                minorPremisePredicate = premise1Predicate;
            }
            
            // Rule 1: Three Terms
            const uniqueTerms = new Set(allTerms);
            const hasThreeTerms = uniqueTerms.size === 3 && 
                                  uniqueTerms.has(majorTerm) && 
                                  uniqueTerms.has(minorTerm) && 
                                  middleTerm !== null;
            
            document.getElementById('proofThreeTerms').value = hasThreeTerms ? 'YES' : 'NO';
            
            // Rule 2: Middle Term Distribution
            let middleDistributedInPremise1 = false;
            let middleDistributedInPremise2 = false;
            
            if (middleTerm) {
                if (premise1Subject === middleTerm) {
                    middleDistributedInPremise1 = (premise1Type === 'A' || premise1Type === 'E');
                }
                if (premise1Predicate === middleTerm) {
                    middleDistributedInPremise1 = middleDistributedInPremise1 || (premise1Type === 'E' || premise1Type === 'O');
                }
                
                if (premise2Subject === middleTerm) {
                    middleDistributedInPremise2 = (premise2Type === 'A' || premise2Type === 'E');
                }
                if (premise2Predicate === middleTerm) {
                    middleDistributedInPremise2 = middleDistributedInPremise2 || (premise2Type === 'E' || premise2Type === 'O');
                }
            }
            
            const middleTermDistributed = middleDistributedInPremise1 || middleDistributedInPremise2;
            document.getElementById('proofMiddleTerm').value = middleTermDistributed ? 'YES' : 'NO';
            
            // Rule 3: Conclusion Distribution
            const sDistributedInConclusion = (conclusionType === 'A' || conclusionType === 'E');
            const pDistributedInConclusion = (conclusionType === 'E' || conclusionType === 'O');
            
            let sDistributedInMinorPremise = false;
            if (minorPremiseSubject === minorTerm) {
                sDistributedInMinorPremise = (minorPremiseType === 'A' || minorPremiseType === 'E');
            }
            if (minorPremisePredicate === minorTerm) {
                sDistributedInMinorPremise = sDistributedInMinorPremise || (minorPremiseType === 'E' || minorPremiseType === 'O');
            }
            
            let pDistributedInMajorPremise = false;
            if (majorPremiseSubject === majorTerm) {
                pDistributedInMajorPremise = (majorPremiseType === 'A' || majorPremiseType === 'E');
            }
            if (majorPremisePredicate === majorTerm) {
                pDistributedInMajorPremise = pDistributedInMajorPremise || (majorPremiseType === 'E' || majorPremiseType === 'O');
            }
            
            let conclusionDistValid = true;
            if (pDistributedInConclusion && !pDistributedInMajorPremise) {
                conclusionDistValid = false;
            }
            if (sDistributedInConclusion && !sDistributedInMinorPremise) {
                conclusionDistValid = false;
            }
            
            document.getElementById('proofConclusionDist').value = conclusionDistValid ? 'YES' : 'NO';
            
            // Rule 4: Exclusive Premises
            const exclusivePremisesValid = negativeCount < 2;
            document.getElementById('proofAffirmative').value = exclusivePremisesValid ? 'YES' : 'NO';
            
            // Rule 5: Negative Matches
            let negativeMatchesValid = true;
            
            if (negativeCount === 1) {
                if (conclusionAffirmative) {
                    negativeMatchesValid = false;
                }
            } else if (negativeCount === 0) {
                if (conclusionNegative) {
                    negativeMatchesValid = false;
                }
            }
            if (negativeCount === 2 && conclusionAffirmative) {
                negativeMatchesValid = false;
            }
            
            document.getElementById('proofNegative').value = negativeMatchesValid ? 'YES' : 'NO';
            
            // Rule 6: Existential Rule
            const premise1Universal = (premise1Type === 'A' || premise1Type === 'E');
            const premise2Universal = (premise2Type === 'A' || premise2Type === 'E');
            const conclusionParticular = (conclusionType === 'I' || conclusionType === 'O');
            
            let existentialValid = true;
            if (conclusionParticular && premise1Universal && premise2Universal) {
                existentialValid = false;
            }
            
            document.getElementById('proofExistential').value = existentialValid ? 'YES' : 'NO';
            
            updateAllFallacyDisplays();
        }

        // ============================================
        // WEB SEARCH
        // ============================================
        
        function updateSearchQuery() {
            const formCode = document.getElementById('validityFormCode').textContent;
            const searchInput = document.getElementById('searchInput');
            
            if (formCode && formCode !== '?' && formCode !== '---' && formCode !== '???') {
                searchInput.value = `Is ${formCode} valid in syllogism? Please give me examples.`;
            } else {
                searchInput.value = 'Is AAA-1 valid in syllogism? Please give me examples.';
            }
        }
        
        function resetSearchQuery() {
            document.getElementById('searchInput').value = 'Is AAA-1 valid in syllogism? Please give me examples.';
        }
        
        function performWebSearch() {
            const query = document.getElementById('searchInput').value;
            const encodedQuery = encodeURIComponent(query);
            const googleSearchUrl = `https://www.google.com/search?q=${encodedQuery}`;
            window.open(googleSearchUrl, '_blank');
        }

        // ============================================
        // RESET FUNCTIONALITY
        // ============================================
        
        function resetSyllogism() {
            document.getElementById('premise1Quantifier').value = 'All';
            document.getElementById('premise1Copula').value = 'are';
            document.getElementById('premise1Subject').value = '';
            document.getElementById('premise1Predicate').value = '';
            document.getElementById('premise1Subject').classList.remove('error');
            document.getElementById('premise1Predicate').classList.remove('error');
            
            document.getElementById('premise2Quantifier').value = 'All';
            document.getElementById('premise2Copula').value = 'are';
            document.getElementById('premise2Subject').value = '';
            document.getElementById('premise2Predicate').value = '';
            document.getElementById('premise2Subject').classList.remove('error');
            document.getElementById('premise2Predicate').classList.remove('error');
            
            document.getElementById('conclusionQuantifier').value = 'All';
            document.getElementById('conclusionCopula').value = 'are';
            document.getElementById('conclusionSubject').innerHTML = '<option value="">Select...</option>';
            document.getElementById('conclusionPredicate').innerHTML = '<option value="">Select...</option>';
            
            document.getElementById('premise1Label').textContent = 'PREMISE 1';
            document.getElementById('premise1Label').classList.remove('major', 'minor');
            document.getElementById('premise2Label').textContent = 'PREMISE 2';
            document.getElementById('premise2Label').classList.remove('major', 'minor');
            document.getElementById('majorTypeLabel').textContent = 'Premise 1 Type';
            document.getElementById('minorTypeLabel').textContent = 'Premise 2 Type';
            
            ['premise1SubjectDist', 'premise1PredicateDist', 'premise2SubjectDist', 'premise2PredicateDist',
             'conclusionSubjectDist', 'conclusionPredicateDist'
            ].forEach(id => {
                const badge = document.getElementById(id);
                if (badge) {
                    badge.textContent = '';
                    badge.className = 'distribution-badge';
                }
            });
            
            document.getElementById('warningBox').classList.remove('visible');
            document.getElementById('successBox').classList.remove('visible');
            
            document.getElementById('premise1Type').textContent = 'A';
            document.getElementById('premise2Type').textContent = 'A';
            document.getElementById('conclusionType').textContent = 'A';
            
            resetValidityDisplay();
            resetProvingTable();
            updateAlternativeExpressions();
            resetSearchQuery();
            
            // Reset syllogism canvases only
            ['premises', 'conclusion'].forEach(tabName => {
                const state = canvasStates[tabName];
                state.regionColors = {};
                state.existenceMarkers = [];
                state.initialized = false;
                
                state.circles = [
                    { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                    { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' },
                    { x: 0, y: 0, r: 120, label: 'Middle (M)', color: 'rgba(34, 197, 94, 0.1)', borderColor: '#22c55e' }
                ];
                
                resizeCanvas(tabName);
            });
        }
        
        function resetStatement() {
            document.getElementById('statementPremiseQuantifier').value = 'All';
            document.getElementById('statementPremiseCopula').value = 'are';
            document.getElementById('statementPremiseSubject').value = '';
            document.getElementById('statementPremisePredicate').value = '';
            document.getElementById('statementPremiseSubject').classList.remove('error');
            document.getElementById('statementPremisePredicate').classList.remove('error');
            
            document.getElementById('statementConclusionQuantifier').value = 'All';
            document.getElementById('statementConclusionCopula').value = 'are';
            document.getElementById('statementConclusionSubject').innerHTML = '<option value="">Select...</option>';
            document.getElementById('statementConclusionPredicate').innerHTML = '<option value="">Select...</option>';
            
            ['statementPremiseSubjectDist', 'statementPremisePredicateDist', 
             'statementConclusionSubjectDist', 'statementConclusionPredicateDist'
            ].forEach(id => {
                const badge = document.getElementById(id);
                if (badge) {
                    badge.textContent = '';
                    badge.className = 'distribution-badge';
                }
            });
            
            document.getElementById('warningBox').classList.remove('visible');
            document.getElementById('successBox').classList.remove('visible');
            
            document.getElementById('statementPremiseType').textContent = 'A';
            document.getElementById('statementConclusionType').textContent = 'A';
            
            updateAlternativeExpressions();
            
            // Reset statement canvases only
            ['premises', 'conclusion'].forEach(tabName => {
                const state = canvasStates[tabName];
                state.regionColors = {};
                state.existenceMarkers = [];
                state.initialized = false;
                
                state.circles = [
                    { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                    { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' }
                ];
                
                resizeCanvas(tabName);
            });
        }

        // ============================================
        // TAB SWITCHING
        // ============================================
        
        let activeTab = 'premises';

        function switchTab(tabName) {
            activeTab = tabName;
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tab-btn.${tabName}`).classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // Always resize and redraw when switching tabs
            resizeCanvas(tabName);
        }

        // ============================================
        // RESIZABLE PANELS (Mouse + Touch)
        // ============================================
        const resizer = document.getElementById('resizer');
        const leftPanel = document.getElementById('leftPanel');
        let isResizing = false;

        // Mouse events
        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            resizer.classList.add('active');
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            const newWidth = e.clientX;
            if (newWidth > 280 && newWidth < window.innerWidth - 300) {
                leftPanel.style.width = newWidth + 'px';
                resizeCanvas('premises');
                resizeCanvas('conclusion');
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('active');
                document.body.style.cursor = 'default';
            }
        });

        // Touch events for resizer
        resizer.addEventListener('touchstart', (e) => {
            isResizing = true;
            resizer.classList.add('active');
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('touchmove', (e) => {
            if (!isResizing) return;
            const touch = e.touches[0];
            const newWidth = touch.clientX;
            if (newWidth > 280 && newWidth < window.innerWidth - 300) {
                leftPanel.style.width = newWidth + 'px';
                resizeCanvas('premises');
                resizeCanvas('conclusion');
            }
        }, { passive: true });

        document.addEventListener('touchend', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('active');
            }
        });

        // ============================================
        // CANVAS SETUP - DUAL CANVASES
        // ============================================
        
        const canvases = {
            premises: document.getElementById('vennCanvasPremises'),
            conclusion: document.getElementById('vennCanvasConclusion')
        };
        
        const contexts = {
            premises: canvases.premises.getContext('2d'),
            conclusion: canvases.conclusion.getContext('2d')
        };

        const canvasStates = {
            premises: {
                selectedColor: '#3b82f6',
                isAristotelian: false,
                circles: [
                    { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                    { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' },
                    { x: 0, y: 0, r: 120, label: 'Middle (M)', color: 'rgba(34, 197, 94, 0.1)', borderColor: '#22c55e' }
                ],
                regionColors: {},
                existenceMarkers: [],
                dragging: null,
                resizingCircle: null,
                draggingExistence: null,
                dragOffset: { x: 0, y: 0 },
                initialized: false,
                isPainting: false,
                lastPaintedRegion: null
            },
            conclusion: {
                selectedColor: '#3b82f6',
                isAristotelian: false,
                circles: [
                    { x: 0, y: 0, r: 120, label: 'Subject (S)', color: 'rgba(59, 130, 246, 0.1)', borderColor: '#3b82f6' },
                    { x: 0, y: 0, r: 120, label: 'Predicate (P)', color: 'rgba(239, 68, 68, 0.1)', borderColor: '#ef4444' },
                    { x: 0, y: 0, r: 120, label: 'Middle (M)', color: 'rgba(34, 197, 94, 0.1)', borderColor: '#22c55e' }
                ],
                regionColors: {},
                existenceMarkers: [],
                dragging: null,
                resizingCircle: null,
                draggingExistence: null,
                dragOffset: { x: 0, y: 0 },
                initialized: false,
                isPainting: false,
                lastPaintedRegion: null
            }
        };

        const MIN_RADIUS = 40;
        const MAX_RADIUS = 200;
        const RESIZE_HANDLE_WIDTH = 15;

        function resizeCanvas(tabName) {
            const container = document.getElementById(`${tabName}Tab`);
            const canvasContainer = container.querySelector('.canvas-container');
            const canvas = canvases[tabName];
            const state = canvasStates[tabName];
            
            // Only resize if container has dimensions (tab is visible)
            if (canvasContainer.clientWidth === 0 || canvasContainer.clientHeight === 0) {
                return;
            }
            
            canvas.width = canvasContainer.clientWidth;
            canvas.height = canvasContainer.clientHeight;
            
            if (!state.initialized) {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                if (currentMode === 'statement' || state.circles.length === 2) {
                    state.circles[0].x = centerX - 80;
                    state.circles[0].y = centerY;
                    state.circles[1].x = centerX + 80;
                    state.circles[1].y = centerY;
                } else {
                    // Three circles for syllogism mode
                    if (diagramLayout === 'upright') {
                        // Upright: M on top
                        state.circles[0].x = centerX - 80;
                        state.circles[0].y = centerY + 50;
                        state.circles[1].x = centerX + 80;
                        state.circles[1].y = centerY + 50;
                        state.circles[2].x = centerX;
                        state.circles[2].y = centerY - 70;
                    } else {
                        // Inverted: M on bottom
                        state.circles[0].x = centerX - 80;
                        state.circles[0].y = centerY - 50;
                        state.circles[1].x = centerX + 80;
                        state.circles[1].y = centerY - 50;
                        state.circles[2].x = centerX;
                        state.circles[2].y = centerY + 70;
                    }
                }
                state.initialized = true;
            }
            
            draw(tabName);
        }

        function getRegionKey(regions) {
            return regions.sort().join('-');
        }

        function pointInCircle(px, py, circle) {
            const dx = px - circle.x;
            const dy = py - circle.y;
            return dx * dx + dy * dy <= circle.r * circle.r;
        }

        function getRegionsAtPoint(x, y, tabName) {
            const state = canvasStates[tabName];
            const regions = [];
            if (pointInCircle(x, y, state.circles[0])) regions.push('S');
            if (pointInCircle(x, y, state.circles[1])) regions.push('P');
            if (state.circles.length > 2 && pointInCircle(x, y, state.circles[2])) regions.push('M');
            return regions;
        }

        function isOnCircleEdge(x, y, circle) {
            const dx = x - circle.x;
            const dy = y - circle.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            return Math.abs(dist - circle.r) <= RESIZE_HANDLE_WIDTH;
        }

        function getCircleEdgeAt(x, y, tabName) {
            const state = canvasStates[tabName];
            for (let i = state.circles.length - 1; i >= 0; i--) {
                if (isOnCircleEdge(x, y, state.circles[i])) {
                    return i;
                }
            }
            return -1;
        }

        function toggleLogic(tabName) {
            const state = canvasStates[tabName];
            state.isAristotelian = !state.isAristotelian;
            const toggle = document.getElementById(`logicToggle${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            const slider = document.getElementById(`toggleSlider${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            
            if (state.isAristotelian) {
                toggle.classList.add('aristotelian');
                slider.textContent = 'Aristotelian';
            } else {
                toggle.classList.remove('aristotelian');
                slider.textContent = 'Boolean';
            }
            
            draw(tabName);
        }

        function addExistence(tabName) {
            const canvas = canvases[tabName];
            const state = canvasStates[tabName];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            state.existenceMarkers.push({
                x: centerX + (Math.random() - 0.5) * 100,
                y: centerY + (Math.random() - 0.5) * 100
            });
            draw(tabName);
        }

        function clearExistence(tabName) {
            canvasStates[tabName].existenceMarkers = [];
            draw(tabName);
        }

        function drawExistenceMarker(ctx, marker, isAristotelian) {
            const size = 12;
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#1e293b';
            ctx.fillStyle = '#1e293b';
            
            if (isAristotelian) {
                ctx.beginPath();
                ctx.arc(marker.x, marker.y, size + 4, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            ctx.beginPath();
            ctx.moveTo(marker.x - size, marker.y - size);
            ctx.lineTo(marker.x + size, marker.y + size);
            ctx.moveTo(marker.x + size, marker.y - size);
            ctx.lineTo(marker.x - size, marker.y + size);
            ctx.stroke();
        }

        function drawResizeHandles(ctx, circle) {
            ctx.save();
            ctx.strokeStyle = 'rgba(100, 100, 100, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(circle.x, circle.y, circle.r, 0, Math.PI * 2);
            ctx.stroke();
            ctx.restore();
        }

        function draw(tabName) {
            const canvas = canvases[tabName];
            const ctx = contexts[tabName];
            const state = canvasStates[tabName];
            
            // Don't draw if canvas has no dimensions
            if (canvas.width === 0 || canvas.height === 0) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawColoredRegions(tabName);
            
            state.circles.forEach((circle, index) => {
                ctx.beginPath();
                ctx.arc(circle.x, circle.y, circle.r, 0, Math.PI * 2);
                ctx.strokeStyle = circle.borderColor;
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.fillStyle = '#1e293b';
                ctx.font = 'bold 14px Segoe UI';
                ctx.textAlign = 'center';
                
                let labelY;
                if (currentMode === 'syllogism' && state.circles.length > 2 && index === 2) {
                    // Middle term label position depends on layout
                    if (diagramLayout === 'upright') {
                        labelY = circle.y - circle.r - 15;
                    } else {
                        labelY = circle.y + circle.r + 25;
                    }
                } else {
                    // S and P labels - position opposite to M
                    if (currentMode === 'syllogism' && diagramLayout === 'inverted') {
                        labelY = circle.y - circle.r - 15;
                    } else {
                        labelY = circle.y + circle.r + 25;
                    }
                }
                ctx.fillText(circle.label, circle.x, labelY);
            });
            
            if (state.resizingCircle !== null) {
                drawResizeHandles(ctx, state.circles[state.resizingCircle]);
            }
            
            state.existenceMarkers.forEach(marker => {
                drawExistenceMarker(ctx, marker, state.isAristotelian);
            });
        }

        function drawColoredRegions(tabName) {
            const canvas = canvases[tabName];
            const ctx = contexts[tabName];
            const state = canvasStates[tabName];
            
            const step = 2;
            for (let x = 0; x < canvas.width; x += step) {
                for (let y = 0; y < canvas.height; y += step) {
                    const regions = getRegionsAtPoint(x, y, tabName);
                    if (regions.length > 0) {
                        const key = getRegionKey([...regions]);
                        if (state.regionColors[key] && state.regionColors[key] !== 'transparent') {
                            ctx.fillStyle = state.regionColors[key];
                            ctx.fillRect(x, y, step, step);
                        }
                    }
                }
            }
        }

        function selectColor(btn, tabName) {
            const palette = btn.closest('.color-palette');
            palette.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            canvasStates[tabName].selectedColor = btn.dataset.color;
        }

        function clearColors(tabName) {
            canvasStates[tabName].regionColors = {};
            draw(tabName);
        }

        function getExistenceAtPoint(x, y, tabName) {
            const state = canvasStates[tabName];
            const hitRadius = 25;
            for (let i = state.existenceMarkers.length - 1; i >= 0; i--) {
                const marker = state.existenceMarkers[i];
                const dist = Math.sqrt((x - marker.x) ** 2 + (y - marker.y) ** 2);
                if (dist <= hitRadius) {
                    return i;
                }
            }
            return -1;
        }

        function updateCursor(x, y, tabName) {
            const canvas = canvases[tabName];
            const state = canvasStates[tabName];
            
            if (getExistenceAtPoint(x, y, tabName) >= 0) {
                canvas.style.cursor = 'grab';
                return;
            }
            
            if (getCircleEdgeAt(x, y, tabName) >= 0) {
                canvas.style.cursor = 'nwse-resize';
                return;
            }
            
            for (const circle of state.circles) {
                const dist = Math.sqrt((x - circle.x) ** 2 + (y - circle.y) ** 2);
                if (dist <= circle.r - RESIZE_HANDLE_WIDTH) {
                    canvas.style.cursor = 'grab';
                    return;
                }
            }
            
            canvas.style.cursor = 'default';
        }

        // ============================================
        // UNIFIED INPUT HANDLING (Mouse + Touch)
        // ============================================
        
        function getEventCoordinates(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            if (e.touches && e.touches.length > 0) {
                return {
                    x: e.touches[0].clientX - rect.left,
                    y: e.touches[0].clientY - rect.top
                };
            } else if (e.changedTouches && e.changedTouches.length > 0) {
                return {
                    x: e.changedTouches[0].clientX - rect.left,
                    y: e.changedTouches[0].clientY - rect.top
                };
            } else {
                return {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
        }

        function handlePointerStart(e, tabName) {
            const canvas = canvases[tabName];
            const currentState = canvasStates[tabName];
            const coords = getEventCoordinates(e, canvas);
            const x = coords.x;
            const y = coords.y;
            
            const existenceIndex = getExistenceAtPoint(x, y, tabName);
            if (existenceIndex >= 0) {
                currentState.draggingExistence = existenceIndex;
                currentState.dragOffset.x = x - currentState.existenceMarkers[existenceIndex].x;
                currentState.dragOffset.y = y - currentState.existenceMarkers[existenceIndex].y;
                canvas.style.cursor = 'grabbing';
                return true;
            }
            
            const edgeIndex = getCircleEdgeAt(x, y, tabName);
            if (edgeIndex >= 0) {
                currentState.resizingCircle = edgeIndex;
                canvas.style.cursor = 'nwse-resize';
                return true;
            }
            
            for (let i = currentState.circles.length - 1; i >= 0; i--) {
                const circle = currentState.circles[i];
                const dist = Math.sqrt((x - circle.x) ** 2 + (y - circle.y) ** 2);
                if (dist <= circle.r * 0.4) {
                    currentState.dragging = i;
                    currentState.dragOffset.x = x - circle.x;
                    currentState.dragOffset.y = y - circle.y;
                    canvas.style.cursor = 'grabbing';
                    return true;
                }
            }
            
            const regions = getRegionsAtPoint(x, y, tabName);
            if (regions.length > 0) {
                currentState.isPainting = true;
                const key = getRegionKey([...regions]);
                currentState.regionColors[key] = currentState.selectedColor;
                currentState.lastPaintedRegion = key;
                draw(tabName);
                return true;
            }
            
            return false;
        }

        function handlePointerMove(e, tabName) {
            const canvas = canvases[tabName];
            const currentState = canvasStates[tabName];
            const coords = getEventCoordinates(e, canvas);
            const x = coords.x;
            const y = coords.y;
            
            if (currentState.draggingExistence !== null) {
                currentState.existenceMarkers[currentState.draggingExistence].x = x - currentState.dragOffset.x;
                currentState.existenceMarkers[currentState.draggingExistence].y = y - currentState.dragOffset.y;
                draw(tabName);
                return true;
            }
            
            if (currentState.resizingCircle !== null) {
                const circle = currentState.circles[currentState.resizingCircle];
                const dx = x - circle.x;
                const dy = y - circle.y;
                const newRadius = Math.sqrt(dx * dx + dy * dy);
                circle.r = Math.max(MIN_RADIUS, Math.min(MAX_RADIUS, newRadius));
                draw(tabName);
                return true;
            }
            
            if (currentState.dragging !== null) {
                currentState.circles[currentState.dragging].x = x - currentState.dragOffset.x;
                currentState.circles[currentState.dragging].y = y - currentState.dragOffset.y;
                draw(tabName);
                return true;
            }
            
            if (currentState.isPainting) {
                const regions = getRegionsAtPoint(x, y, tabName);
                if (regions.length > 0) {
                    const key = getRegionKey([...regions]);
                    if (key !== currentState.lastPaintedRegion) {
                        currentState.regionColors[key] = currentState.selectedColor;
                        currentState.lastPaintedRegion = key;
                        draw(tabName);
                    }
                }
                return true;
            }
            
            if (!e.touches) {
                updateCursor(x, y, tabName);
            }
            
            return false;
        }

        function handlePointerEnd(e, tabName) {
            const canvas = canvases[tabName];
            const currentState = canvasStates[tabName];
            
            currentState.draggingExistence = null;
            currentState.resizingCircle = null;
            currentState.dragging = null;
            currentState.isPainting = false;
            currentState.lastPaintedRegion = null;
            
            canvas.style.cursor = 'default';
            draw(tabName);
        }

        // Set up event listeners for both canvases
        ['premises', 'conclusion'].forEach(tabName => {
            const canvas = canvases[tabName];

            canvas.addEventListener('mousedown', (e) => {
                e.preventDefault();
                handlePointerStart(e, tabName);
            });

            canvas.addEventListener('mousemove', (e) => {
                handlePointerMove(e, tabName);
            });

            canvas.addEventListener('mouseup', (e) => {
                handlePointerEnd(e, tabName);
            });

            canvas.addEventListener('mouseleave', () => {
                handlePointerEnd({}, tabName);
            });

            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handlePointerStart(e, tabName);
            }, { passive: false });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                handlePointerMove(e, tabName);
            }, { passive: false });

            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                handlePointerEnd(e, tabName);
            }, { passive: false });

            canvas.addEventListener('touchcancel', (e) => {
                handlePointerEnd(e, tabName);
            });
        });

        // ============================================
        // DISTRIBUTION LOGIC
        // ============================================
        
        function isTermDistributed(quantifier, copula, position) {
            if (position === 'subject') {
                return quantifier === 'All';
            }
            if (position === 'predicate') {
                return copula === 'are not';
            }
            return false;
        }
        
        function updateDistributionBadges() {
            if (currentMode === 'syllogism') {
                const p1Quantifier = document.getElementById('premise1Quantifier').value;
                const p1Copula = document.getElementById('premise1Copula').value;
                const p1Subject = document.getElementById('premise1Subject').value.trim();
                const p1Predicate = document.getElementById('premise1Predicate').value.trim();
                
                updateBadge('premise1SubjectDist', p1Subject, isTermDistributed(p1Quantifier, p1Copula, 'subject'));
                updateBadge('premise1PredicateDist', p1Predicate, isTermDistributed(p1Quantifier, p1Copula, 'predicate'));
                
                const p2Quantifier = document.getElementById('premise2Quantifier').value;
                const p2Copula = document.getElementById('premise2Copula').value;
                const p2Subject = document.getElementById('premise2Subject').value.trim();
                const p2Predicate = document.getElementById('premise2Predicate').value.trim();
                
                updateBadge('premise2SubjectDist', p2Subject, isTermDistributed(p2Quantifier, p2Copula, 'subject'));
                updateBadge('premise2PredicateDist', p2Predicate, isTermDistributed(p2Quantifier, p2Copula, 'predicate'));
                
                const cQuantifier = document.getElementById('conclusionQuantifier').value;
                const cCopula = document.getElementById('conclusionCopula').value;
                const cSubject = document.getElementById('conclusionSubject').value.trim();
                const cPredicate = document.getElementById('conclusionPredicate').value.trim();
                
                updateBadge('conclusionSubjectDist', cSubject, isTermDistributed(cQuantifier, cCopula, 'subject'));
                updateBadge('conclusionPredicateDist', cPredicate, isTermDistributed(cQuantifier, cCopula, 'predicate'));
            } else {
                const pQuantifier = document.getElementById('statementPremiseQuantifier').value;
                const pCopula = document.getElementById('statementPremiseCopula').value;
                const pSubject = document.getElementById('statementPremiseSubject').value.trim();
                const pPredicate = document.getElementById('statementPremisePredicate').value.trim();
                
                updateBadge('statementPremiseSubjectDist', pSubject, isTermDistributed(pQuantifier, pCopula, 'subject'));
                updateBadge('statementPremisePredicateDist', pPredicate, isTermDistributed(pQuantifier, pCopula, 'predicate'));
                
                const cQuantifier = document.getElementById('statementConclusionQuantifier').value;
                const cCopula = document.getElementById('statementConclusionCopula').value;
                const cSubject = document.getElementById('statementConclusionSubject').value.trim();
                const cPredicate = document.getElementById('statementConclusionPredicate').value.trim();
                
                updateBadge('statementConclusionSubjectDist', cSubject, isTermDistributed(cQuantifier, cCopula, 'subject'));
                updateBadge('statementConclusionPredicateDist', cPredicate, isTermDistributed(cQuantifier, cCopula, 'predicate'));
            }
        }
        
        function updateBadge(badgeId, termValue, isDistributed) {
            const badge = document.getElementById(badgeId);
            if (!badge) return;
            
            if (!termValue) {
                badge.textContent = '';
                badge.className = 'distribution-badge';
                return;
            }
            
            if (isDistributed) {
                badge.textContent = 'D';
                badge.className = 'distribution-badge distributed';
            } else {
                badge.textContent = 'xD';
                badge.className = 'distribution-badge undistributed';
            }
        }

        // ============================================
        // PROPOSITION LOGIC
        // ============================================
        
        function getPropositionType(quantifier, copula) {
            if (quantifier === 'All' && copula === 'are') return 'A';
            if (quantifier === 'All' && copula === 'are not') return 'E';
            if (quantifier === 'Some' && copula === 'are') return 'I';
            if (quantifier === 'Some' && copula === 'are not') return 'O';
            return '?';
        }

        function updateTypes() {
            if (currentMode === 'syllogism') {
                const premise1Type = getPropositionType(
                    document.getElementById('premise1Quantifier').value,
                    document.getElementById('premise1Copula').value
                );
                const premise2Type = getPropositionType(
                    document.getElementById('premise2Quantifier').value,
                    document.getElementById('premise2Copula').value
                );
                const conclusionType = getPropositionType(
                    document.getElementById('conclusionQuantifier').value,
                    document.getElementById('conclusionCopula').value
                );
                
                document.getElementById('premise1Type').textContent = premise1Type;
                document.getElementById('premise2Type').textContent = premise2Type;
                document.getElementById('conclusionType').textContent = conclusionType;
            } else {
                const premiseType = getPropositionType(
                    document.getElementById('statementPremiseQuantifier').value,
                    document.getElementById('statementPremiseCopula').value
                );
                const conclusionType = getPropositionType(
                    document.getElementById('statementConclusionQuantifier').value,
                    document.getElementById('statementConclusionCopula').value
                );
                
                document.getElementById('statementPremiseType').textContent = premiseType;
                document.getElementById('statementConclusionType').textContent = conclusionType;
            }
            
            resetValidityDisplay();
        }

        function resetValidityDisplay() {
            const validityDisplay = document.getElementById('validityDisplay');
            const validityFormCode = document.getElementById('validityFormCode');
            const validityName = document.getElementById('validityName');
            const validityBadge = document.getElementById('validityBadge');
            const validityNote = document.getElementById('validityNote');
            
            validityDisplay.className = 'validity-display pending';
            validityFormCode.textContent = '?';
            validityName.textContent = 'Is it Valid?';
            validityBadge.textContent = 'Click to Check';
            validityNote.textContent = 'Fill in the syllogism and click "Check Validity" to determine if it\'s a valid form.';
            
            updateSearchQuery();
        }

        function validatePropositions() {
            if (currentMode === 'statement') {
                return validateStatementPropositions();
            }
            
            const premise1Subject = document.getElementById('premise1Subject').value.trim().toLowerCase();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim().toLowerCase();
            const premise2Subject = document.getElementById('premise2Subject').value.trim().toLowerCase();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim().toLowerCase();
            const conclusionSubject = document.getElementById('conclusionSubject').value.trim().toLowerCase();
            const conclusionPredicate = document.getElementById('conclusionPredicate').value.trim().toLowerCase();
            
            const warnings = [];
            
            document.getElementById('premise1Subject').classList.remove('error');
            document.getElementById('premise1Predicate').classList.remove('error');
            document.getElementById('premise2Subject').classList.remove('error');
            document.getElementById('premise2Predicate').classList.remove('error');
            
            const premisesFilled = premise1Subject && premise1Predicate && premise2Subject && premise2Predicate;
            const conclusionFilled = conclusionSubject && conclusionPredicate;
            const allFilled = premisesFilled && conclusionFilled;
            
            if (premisesFilled) {
                if (premise1Subject === premise1Predicate) {
                    warnings.push('Premise 1: Subject and Predicate must be different terms.');
                    document.getElementById('premise1Subject').classList.add('error');
                    document.getElementById('premise1Predicate').classList.add('error');
                }
                
                if (premise2Subject === premise2Predicate) {
                    warnings.push('Premise 2: Subject and Predicate must be different terms.');
                    document.getElementById('premise2Subject').classList.add('error');
                    document.getElementById('premise2Predicate').classList.add('error');
                }
                
                const premiseTerms = [premise1Subject, premise1Predicate, premise2Subject, premise2Predicate];
                const uniquePremiseTerms = new Set(premiseTerms);
                
                if (uniquePremiseTerms.size !== 3) {
                    if (uniquePremiseTerms.size < 3) {
                        warnings.push(`Only ${uniquePremiseTerms.size} unique term(s) found in premises. A valid syllogism requires exactly 3 unique terms.`);
                    } else {
                        warnings.push(`${uniquePremiseTerms.size} unique terms found in premises. A valid syllogism requires exactly 3 unique terms.`);
                    }
                }
            }
            
            if (allFilled) {
                if (conclusionSubject === conclusionPredicate) {
                    warnings.push('Conclusion: Subject and Predicate must be different terms.');
                }
                
                const premise1TermsArr = [premise1Subject, premise1Predicate];
                const premise2TermsArr = [premise2Subject, premise2Predicate];
                
                let middleTerm = null;
                for (const term of premise1TermsArr) {
                    if (premise2TermsArr.includes(term)) {
                        middleTerm = term;
                        break;
                    }
                }
                
                if (middleTerm) {
                    if (conclusionSubject === middleTerm || conclusionPredicate === middleTerm) {
                        warnings.push(`Middle term "${middleTerm}" cannot appear in the conclusion.`);
                    }
                }
                
                const allPremiseTerms = new Set([premise1Subject, premise1Predicate, premise2Subject, premise2Predicate]);
                if (!allPremiseTerms.has(conclusionSubject)) {
                    warnings.push(`Conclusion subject "${conclusionSubject}" must appear in one of the premises.`);
                }
                if (!allPremiseTerms.has(conclusionPredicate)) {
                    warnings.push(`Conclusion predicate "${conclusionPredicate}" must appear in one of the premises.`);
                }
            }
            
            const warningBox = document.getElementById('warningBox');
            const warningList = document.getElementById('warningList');
            const successBox = document.getElementById('successBox');
            
            if (warnings.length > 0) {
                warningList.innerHTML = warnings.map(w => `<li>${w}</li>`).join('');
                warningBox.classList.add('visible');
                successBox.classList.remove('visible');
            } else if (allFilled) {
                warningBox.classList.remove('visible');
                successBox.classList.add('visible');
            } else {
                warningBox.classList.remove('visible');
                successBox.classList.remove('visible');
            }
            
            return warnings.length === 0;
        }

        function validateStatementPropositions() {
            const premiseSubject = document.getElementById('statementPremiseSubject').value.trim().toLowerCase();
            const premisePredicate = document.getElementById('statementPremisePredicate').value.trim().toLowerCase();
            const conclusionSubject = document.getElementById('statementConclusionSubject').value.trim().toLowerCase();
            const conclusionPredicate = document.getElementById('statementConclusionPredicate').value.trim().toLowerCase();
            
            const warnings = [];
            
            document.getElementById('statementPremiseSubject').classList.remove('error');
            document.getElementById('statementPremisePredicate').classList.remove('error');
            
            const premiseFilled = premiseSubject && premisePredicate;
            const conclusionFilled = conclusionSubject && conclusionPredicate;
            const allFilled = premiseFilled && conclusionFilled;
            
            if (premiseFilled) {
                if (premiseSubject === premisePredicate) {
                    warnings.push('Premise: Subject and Predicate must be different terms.');
                    document.getElementById('statementPremiseSubject').classList.add('error');
                    document.getElementById('statementPremisePredicate').classList.add('error');
                }
            }
            
            if (allFilled) {
                if (conclusionSubject === conclusionPredicate) {
                    warnings.push('Conclusion: Subject and Predicate must be different terms.');
                }
            }
            
            const warningBox = document.getElementById('warningBox');
            const warningList = document.getElementById('warningList');
            const successBox = document.getElementById('successBox');
            
            if (warnings.length > 0) {
                warningList.innerHTML = warnings.map(w => `<li>${w}</li>`).join('');
                warningBox.classList.add('visible');
                successBox.classList.remove('visible');
            } else if (allFilled) {
                warningBox.classList.remove('visible');
                successBox.classList.add('visible');
            } else {
                warningBox.classList.remove('visible');
                successBox.classList.remove('visible');
            }
            
            return warnings.length === 0;
        }

        function updateConclusionOptions() {
            const terms = new Set();
            
            const premise1Subject = document.getElementById('premise1Subject').value.trim();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim();
            const premise2Subject = document.getElementById('premise2Subject').value.trim();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim();
            
            if (premise1Subject) terms.add(premise1Subject);
            if (premise1Predicate) terms.add(premise1Predicate);
            if (premise2Subject) terms.add(premise2Subject);
            if (premise2Predicate) terms.add(premise2Predicate);
            
            const conclusionSubject = document.getElementById('conclusionSubject');
            const conclusionPredicate = document.getElementById('conclusionPredicate');
            
            const currentSubject = conclusionSubject.value;
            const currentPredicate = conclusionPredicate.value;
            
            conclusionSubject.innerHTML = '<option value="">Select...</option>';
            conclusionPredicate.innerHTML = '<option value="">Select...</option>';
            
            terms.forEach(term => {
                const opt1 = document.createElement('option');
                opt1.value = term;
                opt1.textContent = term;
                conclusionSubject.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = term;
                opt2.textContent = term;
                conclusionPredicate.appendChild(opt2);
            });
            
            if (terms.has(currentSubject)) conclusionSubject.value = currentSubject;
            if (terms.has(currentPredicate)) conclusionPredicate.value = currentPredicate;
        }

        function updateStatementConclusionOptions() {
            const terms = new Set();
            
            const premiseSubject = document.getElementById('statementPremiseSubject').value.trim();
            const premisePredicate = document.getElementById('statementPremisePredicate').value.trim();
            
            if (premiseSubject) terms.add(premiseSubject);
            if (premisePredicate) terms.add(premisePredicate);
            
            const conclusionSubject = document.getElementById('statementConclusionSubject');
            const conclusionPredicate = document.getElementById('statementConclusionPredicate');
            
            const currentSubject = conclusionSubject.value;
            const currentPredicate = conclusionPredicate.value;
            
            conclusionSubject.innerHTML = '<option value="">Select...</option>';
            conclusionPredicate.innerHTML = '<option value="">Select...</option>';
            
            terms.forEach(term => {
                const opt1 = document.createElement('option');
                opt1.value = term;
                opt1.textContent = term;
                conclusionSubject.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = term;
                opt2.textContent = term;
                conclusionPredicate.appendChild(opt2);
            });
            
            if (terms.has(currentSubject)) conclusionSubject.value = currentSubject;
            if (terms.has(currentPredicate)) conclusionPredicate.value = currentPredicate;
        }

        function updatePremiseLabels() {
            const conclusionSubject = document.getElementById('conclusionSubject').value.trim().toLowerCase();
            const conclusionPredicate = document.getElementById('conclusionPredicate').value.trim().toLowerCase();
            
            const premise1Subject = document.getElementById('premise1Subject').value.trim().toLowerCase();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim().toLowerCase();
            const premise2Subject = document.getElementById('premise2Subject').value.trim().toLowerCase();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim().toLowerCase();
            
            const premise1Label = document.getElementById('premise1Label');
            const premise2Label = document.getElementById('premise2Label');
            const majorTypeLabel = document.getElementById('majorTypeLabel');
            const minorTypeLabel = document.getElementById('minorTypeLabel');
            
            premise1Label.textContent = 'PREMISE 1';
            premise1Label.classList.remove('major', 'minor');
            premise2Label.textContent = 'PREMISE 2';
            premise2Label.classList.remove('major', 'minor');
            majorTypeLabel.textContent = 'Premise 1 Type';
            minorTypeLabel.textContent = 'Premise 2 Type';
            
            if (!conclusionSubject || !conclusionPredicate) return;
            
            const premise1Terms = [premise1Subject, premise1Predicate];
            const premise2Terms = [premise2Subject, premise2Predicate];
            
            const premise1HasMajor = premise1Terms.includes(conclusionPredicate);
            const premise1HasMinor = premise1Terms.includes(conclusionSubject);
            const premise2HasMajor = premise2Terms.includes(conclusionPredicate);
            const premise2HasMinor = premise2Terms.includes(conclusionSubject);
            
            if (premise1HasMajor && !premise1HasMinor && premise2HasMinor && !premise2HasMajor) {
                premise1Label.textContent = 'MAJOR PREMISE';
                premise1Label.classList.add('major');
                premise2Label.textContent = 'MINOR PREMISE';
                premise2Label.classList.add('minor');
                majorTypeLabel.textContent = 'Major Type';
                minorTypeLabel.textContent = 'Minor Type';
            } else if (premise2HasMajor && !premise2HasMinor && premise1HasMinor && !premise1HasMajor) {
                premise1Label.textContent = 'MINOR PREMISE';
                premise1Label.classList.add('minor');
                premise2Label.textContent = 'MAJOR PREMISE';
                premise2Label.classList.add('major');
                majorTypeLabel.textContent = 'Minor Type';
                minorTypeLabel.textContent = 'Major Type';
            }
        }

        function updateLabels() {
            if (currentMode === 'statement') {
                updateLabelsForMode();
                return;
            }
            
            const conclusionSubject = document.getElementById('conclusionSubject').value || 'Subject (S)';
            const conclusionPredicate = document.getElementById('conclusionPredicate').value || 'Predicate (P)';
            
            const premise1Subject = document.getElementById('premise1Subject').value.trim();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim();
            const premise2Subject = document.getElementById('premise2Subject').value.trim();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim();
            
            const allTerms = [premise1Subject, premise1Predicate, premise2Subject, premise2Predicate].filter(t => t);
            const termCounts = {};
            allTerms.forEach(t => {
                const lower = t.toLowerCase();
                termCounts[lower] = termCounts[lower] || { count: 0, original: t };
                termCounts[lower].count++;
            });
            
            let middleTerm = 'Middle (M)';
            const conclusionSubjectLower = conclusionSubject.toLowerCase();
            const conclusionPredicateLower = conclusionPredicate.toLowerCase();
            
            for (const [term, data] of Object.entries(termCounts)) {
                if (data.count >= 2 && term !== conclusionSubjectLower && term !== conclusionPredicateLower) {
                    middleTerm = data.original;
                    break;
                }
            }
            
            const sLabel = conclusionSubject === 'Subject (S)' ? 'Subject (S)' : conclusionSubject + ' (S)';
            const pLabel = conclusionPredicate === 'Predicate (P)' ? 'Predicate (P)' : conclusionPredicate + ' (P)';
            const mLabel = middleTerm === 'Middle (M)' ? 'Middle (M)' : middleTerm + ' (M)';
            
            ['premises', 'conclusion'].forEach(tabName => {
                canvasStates[tabName].circles[0].label = sLabel;
                canvasStates[tabName].circles[1].label = pLabel;
                if (canvasStates[tabName].circles.length > 2) {
                    canvasStates[tabName].circles[2].label = mLabel;
                }
            });
            
            draw('premises');
            draw('conclusion');
        }

        // ============================================
        // FIGURE DETERMINATION
        // ============================================
        
        function determineFigure() {
            const premise1Subject = document.getElementById('premise1Subject').value.trim().toLowerCase();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim().toLowerCase();
            const premise2Subject = document.getElementById('premise2Subject').value.trim().toLowerCase();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim().toLowerCase();
            const conclusionSubject = document.getElementById('conclusionSubject').value.trim().toLowerCase();
            const conclusionPredicate = document.getElementById('conclusionPredicate').value.trim().toLowerCase();
            
            if (!premise1Subject || !premise1Predicate || !premise2Subject || !premise2Predicate || 
                !conclusionSubject || !conclusionPredicate) {
                return null;
            }
            
            const premise1TermsArr = [premise1Subject, premise1Predicate];
            const premise2TermsArr = [premise2Subject, premise2Predicate];
            
            let middleTerm = null;
            for (const term of premise1TermsArr) {
                if (premise2TermsArr.includes(term) && term !== conclusionSubject && term !== conclusionPredicate) {
                    middleTerm = term;
                    break;
                }
            }
            
            if (!middleTerm) {
                return { error: 'Cannot identify middle term. The middle term must appear in both premises but not in the conclusion.' };
            }
            
            const majorTerm = conclusionPredicate;
            const minorTerm = conclusionSubject;
            
            const premise1HasMajor = premise1TermsArr.includes(majorTerm);
            const premise2HasMinor = premise2TermsArr.includes(minorTerm);
            const premise2HasMajor = premise2TermsArr.includes(majorTerm);
            const premise1HasMinor = premise1TermsArr.includes(minorTerm);
            
            let majorPremise, minorPremise;
            
            if (premise1HasMajor && premise2HasMinor) {
                majorPremise = { subject: premise1Subject, predicate: premise1Predicate };
                minorPremise = { subject: premise2Subject, predicate: premise2Predicate };
            } else if (premise2HasMajor && premise1HasMinor) {
                majorPremise = { subject: premise2Subject, predicate: premise2Predicate };
                minorPremise = { subject: premise1Subject, predicate: premise1Predicate };
            } else {
                return { error: 'Cannot identify major and minor premises. Each premise should contain exactly one of the conclusion terms.' };
            }
            
            const middleInMajorSubject = majorPremise.subject === middleTerm;
            const middleInMajorPredicate = majorPremise.predicate === middleTerm;
            const middleInMinorSubject = minorPremise.subject === middleTerm;
            const middleInMinorPredicate = minorPremise.predicate === middleTerm;
            
            let figure;
            if (middleInMajorSubject && middleInMinorPredicate) {
                figure = 1;
            } else if (middleInMajorPredicate && middleInMinorPredicate) {
                figure = 2;
            } else if (middleInMajorSubject && middleInMinorSubject) {
                figure = 3;
            } else if (middleInMajorPredicate && middleInMinorSubject) {
                figure = 4;
            } else {
                return { error: 'Cannot determine figure from the position of the middle term.' };
            }
            
            const premise1Type = getPropositionType(
                document.getElementById('premise1Quantifier').value,
                document.getElementById('premise1Copula').value
            );
            const premise2Type = getPropositionType(
                document.getElementById('premise2Quantifier').value,
                document.getElementById('premise2Copula').value
            );
            const conclusionType = getPropositionType(
                document.getElementById('conclusionQuantifier').value,
                document.getElementById('conclusionCopula').value
            );
            
            let majorType, minorType;
            if (premise1HasMajor) {
                majorType = premise1Type;
                minorType = premise2Type;
            } else {
                majorType = premise2Type;
                minorType = premise1Type;
            }
            
            const mood = majorType + minorType + conclusionType;
            
            return { figure, mood, middleTerm };
        }

        // ============================================
        // VALIDITY CHECKING
        // ============================================
        
        function checkValidity() {
            if (currentMode === 'statement') return;
            
            const validityDisplay = document.getElementById('validityDisplay');
            const validityFormCode = document.getElementById('validityFormCode');
            const validityName = document.getElementById('validityName');
            const validityBadge = document.getElementById('validityBadge');
            const validityNote = document.getElementById('validityNote');
            
            const premise1Subject = document.getElementById('premise1Subject').value.trim();
            const premise1Predicate = document.getElementById('premise1Predicate').value.trim();
            const premise2Subject = document.getElementById('premise2Subject').value.trim();
            const premise2Predicate = document.getElementById('premise2Predicate').value.trim();
            const conclusionSubject = document.getElementById('conclusionSubject').value.trim();
            const conclusionPredicate = document.getElementById('conclusionPredicate').value.trim();
            
            if (!premise1Subject || !premise1Predicate || !premise2Subject || !premise2Predicate ||
                !conclusionSubject || !conclusionPredicate) {
                validityDisplay.className = 'validity-display invalid';
                validityFormCode.textContent = '---';
                validityName.textContent = 'Incomplete Input';
                validityBadge.textContent = 'Missing Data';
                validityNote.textContent = 'Please fill in all premise terms and select conclusion subject/predicate.';
                updateSearchQuery();
                return;
            }
            
            const figureInfo = determineFigure();
            
            if (!figureInfo || figureInfo.error) {
                validityDisplay.className = 'validity-display invalid';
                validityFormCode.textContent = '???';
                validityName.textContent = 'Invalid Structure';
                validityBadge.textContent = '‚úó Invalid';
                validityNote.textContent = figureInfo ? figureInfo.error : 'Invalid syllogism structure.';
                updateSearchQuery();
                return;
            }
            
            const { figure, mood } = figureInfo;
            const formCode = `${mood}-${figure}`;
            
            if (unconditionallyValid[figure] && unconditionallyValid[figure][mood]) {
                const name = unconditionallyValid[figure][mood];
                validityDisplay.className = 'validity-display valid';
                validityFormCode.textContent = formCode;
                validityName.textContent = name;
                validityBadge.textContent = '‚úì Valid';
                validityNote.textContent = 'Unconditionally valid in both Boolean and Aristotelian logic.';
                updateSearchQuery();
                return;
            }
            
            if (conditionallyValid[figure] && conditionallyValid[figure][mood]) {
                const info = conditionallyValid[figure][mood];
                validityDisplay.className = 'validity-display conditional';
                validityFormCode.textContent = formCode;
                validityName.textContent = info.name;
                validityBadge.textContent = '‚ö† Conditionally Valid';
                validityNote.textContent = `Valid only in Aristotelian logic. ${info.condition}.`;
                updateSearchQuery();
                return;
            }
            
            validityDisplay.className = 'validity-display invalid';
            validityFormCode.textContent = formCode;
            validityName.textContent = 'No Valid Form';
            validityBadge.textContent = '‚úó Invalid';
            validityNote.textContent = `The form ${formCode} is not among the 24 valid syllogistic forms.`;
            updateSearchQuery();
        }

        // ============================================
        // EVENT HANDLERS
        // ============================================

        function handlePremiseInput() {
            updateConclusionOptions();
            validatePropositions();
            updatePremiseLabels();
            updateLabels();
            updateTypes();
            updateDistributionBadges();
            updateAlternativeExpressions();
            resetValidityDisplay();
        }

        function handleConclusionChange() {
            validatePropositions();
            updatePremiseLabels();
            updateLabels();
            updateTypes();
            updateDistributionBadges();
            updateAlternativeExpressions();
            resetValidityDisplay();
        }

        function handleQuantifierCopulaChange() {
            updateTypes();
            updateDistributionBadges();
            updateAlternativeExpressions();
            resetValidityDisplay();
        }

        function handleStatementChange() {
            updateStatementConclusionOptions();
            validateStatementPropositions();
            updateTypes();
            updateDistributionBadges();
            updateAlternativeExpressions();
            updateLabelsForMode();
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.getElementById('checkValidityBtn').addEventListener('click', function(e) {
            e.preventDefault();
            checkValidity();
        });
        
        window.addEventListener('resize', () => {
            resizeCanvas('premises');
            resizeCanvas('conclusion');
        });
        
        // Initialize both canvases
        resizeCanvas('premises');
        resizeCanvas('conclusion');
        updateTypes();
        updateDistributionBadges();
        updateAlternativeExpressions();
        resetSearchQuery();
    </script>


</body></html>